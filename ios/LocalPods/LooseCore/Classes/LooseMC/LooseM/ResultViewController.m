
#import <Foundation/Foundation.h>

NSString *StringFromLeyData(Byte *data);        


//: xlkkqow/oqizoaNpr
Byte kViewTimeName[] = {57, 17, 84, 11, 227, 1, 21, 209, 246, 103, 67, 36, 24, 23, 23, 29, 27, 35, 219, 27, 29, 21, 38, 27, 13, 250, 28, 30, 77};


//: url
Byte k_highwayFlueAttitudeName[] = {55, 3, 37, 8, 66, 72, 214, 115, 80, 77, 71, 238};


//: 网络开小差了，请重试~
Byte k_unemploymentChronicCoordinateName[] = {28, 31, 48, 8, 153, 56, 20, 14, 183, 141, 97, 183, 139, 108, 181, 140, 80, 181, 128, 95, 181, 135, 126, 180, 138, 86, 191, 140, 92, 184, 127, 135, 185, 87, 93, 184, 127, 101, 78, 180};


//: %@的相册
Byte kUndergraduateTitle[] = {39, 11, 68, 10, 83, 157, 168, 241, 178, 174, 225, 252, 163, 86, 64, 163, 87, 116, 161, 66, 72, 210};


//: xlkkqow/sqkqaqNpr
Byte k_objectLampTitle[] = {7, 17, 63, 12, 218, 76, 139, 213, 112, 232, 48, 254, 57, 45, 44, 44, 50, 48, 56, 240, 52, 50, 44, 50, 34, 50, 15, 49, 51, 124};


//: xlkkqow/tnkzls
Byte kCuriousContent[] = {33, 14, 49, 11, 92, 20, 18, 107, 74, 254, 151, 71, 59, 58, 58, 64, 62, 70, 254, 67, 61, 58, 73, 59, 66, 139};


//: 保存成功
Byte k_suddenMiteWithName[] = {66, 12, 61, 13, 27, 26, 216, 118, 232, 159, 239, 158, 130, 167, 130, 96, 168, 112, 91, 169, 75, 83, 168, 77, 98, 208};


//: 保存
Byte kElevenValue[] = {30, 6, 96, 4, 132, 95, 61, 133, 77, 56, 29};


//: pids
Byte kSternName[] = {42, 4, 47, 14, 202, 194, 87, 146, 203, 107, 172, 213, 178, 255, 65, 58, 53, 68, 195};


//: data
Byte kDecisionName[] = {44, 4, 43, 10, 113, 213, 113, 39, 36, 233, 57, 54, 73, 54, 236};


//: 请求超时，请重试
Byte kGalleryName[] = {92, 24, 12, 12, 59, 226, 155, 72, 11, 89, 251, 80, 220, 163, 171, 218, 165, 118, 220, 170, 121, 218, 139, 170, 227, 176, 128, 220, 163, 171, 221, 123, 129, 220, 163, 137, 164};


//: image
Byte k_heliText[] = {78, 5, 42, 11, 87, 99, 69, 39, 170, 172, 148, 63, 67, 55, 61, 59, 142};


//: pic
Byte kDemographicContent[] = {97, 3, 1, 10, 209, 197, 87, 185, 26, 9, 111, 104, 98, 64};


//: 最多只能选择%d张照片
Byte k_quitBooValue[] = {26, 29, 7, 14, 150, 40, 62, 64, 237, 53, 174, 79, 135, 158, 223, 149, 121, 222, 157, 147, 222, 136, 163, 225, 124, 182, 226, 121, 130, 223, 132, 162, 30, 93, 222, 181, 153, 224, 126, 160, 224, 130, 128, 246};


//: 相册
Byte k_totValue[] = {41, 6, 36, 8, 13, 188, 63, 187, 195, 119, 148, 193, 98, 104, 196};


//: (%.0f%%)保存中...
Byte kBraveOldenName[] = {54, 20, 3, 11, 54, 40, 144, 151, 12, 129, 149, 37, 34, 43, 45, 99, 34, 34, 38, 225, 188, 154, 226, 170, 149, 225, 181, 170, 43, 43, 43, 226};

// __DEBUG__
// __CLOSE_PRINT__
//
//  ResultViewController.m
//  FZIphone
//
//  Created by bellchen on 2017/4/21.
//  Copyright © 2017年 app. All rights reserved.
//

//: #import "LFCEditAlbumViewController.h"
#import "ResultViewController.h"
//: #import "LXReorderableCollectionViewFlowLayout.h"
#import "Current.h"
//: #import "LFCGalleryModel.h"
#import "GalleryModel.h"
//: #import "LFCGalleryCCell.h"
#import "GalleryUpBbbbView.h"
//: #import "LFCImagePreviewController.h"
#import "IdentityControllerBbbb.h"

//: #import "NSMutableArray+Additions.h"
#import "NSMutableArray+Info.h"

//: #import "LFC1v1TalkSocketManager.h"
#import "ManagingDirectorBbbb.h"

//: #define kMaxImagesCount 32
#define kMaxImagesCount 32


//: @interface LFCEditAlbumViewController ()
@interface ResultViewController ()
//: <LXReorderableCollectionViewDataSource,
<ReleaseBbbb,
//: LXReorderableCollectionViewDelegateFlowLayout>
ChaseReceive>

//: @property (nonatomic, strong, readwrite) UICollectionView *collectionView;
@property (nonatomic, strong, readwrite) UICollectionView *makeBe;
//: @property (nonatomic, strong, readwrite) NSMutableArray<LFCGalleryModel*> *deleteGalleryArray;
@property (nonatomic, strong, readwrite) NSMutableArray<GalleryModel*> *summate;
//: @property (nonatomic, assign, readwrite) BOOL hasChange;
@property (nonatomic, assign, readwrite) BOOL halogen;
//: @property (nonatomic, strong, readwrite) MBProgressHUD *hud;
@property (nonatomic, strong, readwrite) MBProgressHUD *sex;
//: @property (nonatomic, assign, readwrite) NSInteger currentTaskIndex;
@property (nonatomic, assign, readwrite) NSInteger buildStatus;
//: @property (nonatomic, assign, readwrite) NSInteger taskNumber;
@property (nonatomic, assign, readwrite) NSInteger imageCancel;
//: @property (nonatomic, assign, readwrite) NSInteger type;
@property (nonatomic, assign, readwrite) NSInteger kick;
//: @end
@end

//: @implementation LFCEditAlbumViewController
@implementation ResultViewController

//: - (instancetype)initWithType:(NSInteger)type{
- (instancetype)initWithShow:(NSInteger)type{
    //: if (self = [super init]) {
    if (self = [super init]) {
        //: self.type = type;
        self.kick = type;
    }
    //: return self;
    return self;
}

//: - (void)viewDidLoad {
- (void)viewDidLoad {
    
    //: [super viewDidLoad];
    [super viewDidLoad];

    //: self.view.backgroundColor=[UIColor whiteColor];
    self.view.backgroundColor=[UIColor whiteColor];
    //: [self.collectionView reloadData];
    [self.makeBe reloadData];
    //: [self func__buildNavBar];
    [self ban];
}

//: - (void)func__buildNavBar{
- (void)ban{
    //: UILabel* label = [[UILabel alloc] init];
    UILabel* label = [[UILabel alloc] init];
    //: label.textColor = [ShowColor appTextColor];
    label.textColor = [ShowColor current];
    //: label.font = [UIFont PingFangFontWithType:(PFSCTypeMedium) fontSize:16.0];
    label.font = [UIFont underbelly:(PFSCTypeMedium) substance:16.0];
    //: if (self.userName && self.userName.length) {
    if (self.pic && self.pic.length) {
        //: label.text = [NSString stringWithFormat:@"%@的相册",self.userName.mutableCopy];
        label.text = [NSString stringWithFormat:StringFromLeyData(kUndergraduateTitle),self.pic.mutableCopy];
    //: }else{
    }else{
        //: label.text = (@"相册");
        label.text = (StringFromLeyData(k_totValue));
    }
    //: [label sizeToFit];
    [label sizeToFit];
    //: self.navigationItem.titleView = label;
    self.navigationItem.titleView = label;
 
    
    //: if (self.type == GJAlbumTypeEnableEdit) {
    if (self.kick == GJAlbumTypeEnableEdit) {
        //: UIButton *btn = [UIButton buttonWithType:UIButtonTypeCustom];
        UIButton *btn = [UIButton buttonWithType:UIButtonTypeCustom];
        //: [btn setTitleColor:RGBA(180, 180, 180, 1) forState:UIControlStateDisabled];
        [btn setTitleColor:RGBA(180, 180, 180, 1) forState:UIControlStateDisabled];
        //: [btn setTitleColor:ShowColor.appTextColor forState:UIControlStateNormal];
        [btn setTitleColor:ShowColor.current forState:UIControlStateNormal];
        //: [btn setTitle:@"保存" forState:UIControlStateNormal];
        [btn setTitle:StringFromLeyData(kElevenValue) forState:UIControlStateNormal];
        // btn.bounds = CGRectMake(0, 0, 40, 44);
        //: [btn sizeToFit];
        [btn sizeToFit];
        //: [btn addTarget:self action:@selector(saveAction:) forControlEvents:UIControlEventTouchUpInside];
        [btn addTarget:self action:@selector(analogDigitalConverter:) forControlEvents:UIControlEventTouchUpInside];
        //: self.navigationItem.rightBarButtonItem = [[UIBarButtonItem alloc] initWithCustomView:btn];
        self.navigationItem.rightBarButtonItem = [[UIBarButtonItem alloc] initWithCustomView:btn];
        
        //: RAC(btn, enabled) =
        RAC(btn, enabled) =
        //: [RACSignal combineLatest:@[RACObserve(self, hasChange)] reduce:^id (NSNumber *hasChange){
        [RACSignal combineLatest:@[RACObserve(self, halogen)] reduce:^id (NSNumber *hasChange){
            
            //: if (hasChange.boolValue) {
            if (hasChange.boolValue) {
                //: return @YES;
                return @YES;
            }
            //: return @NO;
            return @NO;
        //: }];
        }];
    }
}


//: #pragma mark - action
#pragma mark - action
//: - (void)showError:(NSError *)error{
- (void)target:(NSError *)error{
    //: if (error.code == NSURLErrorTimedOut) {
    if (error.code == NSURLErrorTimedOut) {
        //: [self showStatusBarErrorStr:(@"请求超时，请重试")];
        [self push:(StringFromLeyData(kGalleryName))];
    //: }else{
    }else{
        //: if (error) {
        if (error) {
            //: [self showStatusBarError:error];
            [self user:error];
        //: } else {
        } else {
            //: [self showStatusBarErrorStr:(@"网络开小差了，请重试~")];
            [self push:(StringFromLeyData(k_unemploymentChronicCoordinateName))];
        }
    }
}
//: - (RACSignal*)createSignal:(void(^)(id<RACSubscriber> subscriber))block{
- (RACSignal*)modelSignal:(void(^)(id<RACSubscriber> subscriber))block{
    //: return [RACSignal createSignal:^RACDisposable *(id<RACSubscriber> subscriber) {
    return [RACSignal createSignal:^RACDisposable *(id<RACSubscriber> subscriber) {
        //: dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, 0), ^{
        dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, 0), ^{
            //: if (block) {
            if (block) {
                //: block(subscriber);
                block(subscriber);
            }
        //: });
        });
        //: return [RACDisposable disposableWithBlock:^{
        return [RACDisposable disposableWithBlock:^{
            
        //: }];
        }];
    //: }];
    }];
}
//: - (RACSignal*)deleteSignal{
- (RACSignal*)saySignalIcon{
    
    //: @weakify(self);
    @weakify(self);
    //: RACSignal *deleteSignal = [self createSignal:^(id<RACSubscriber> subscriber) {
    RACSignal *deleteSignal = [self modelSignal:^(id<RACSubscriber> subscriber) {
        //: @strongify(self);
        @strongify(self);
        //: NSMutableArray<NSString*> *pids = [[NSMutableArray alloc] init];
        NSMutableArray<NSString*> *pids = [[NSMutableArray alloc] init];
        //: [self.deleteGalleryArray enumerateObjectsUsingBlock:^(LFCGalleryModel * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
        [self.summate enumerateObjectsUsingBlock:^(GalleryModel * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
            //: if (obj.id > 0) {
            if (obj.id > 0) {
                //: [pids addObject:[NSString stringWithFormat:@"%zd",obj.id]];
                [pids addObject:[NSString stringWithFormat:@"%zd",obj.id]];
            }
        //: }];
        }];
        //: if (pids.count == 0) {
        if (pids.count == 0) {
            //: [subscriber sendCompleted];
            [subscriber sendCompleted];
            //: return;
            return;
        }
        //: TalkingRequest *setup=[[TalkingRequest alloc] init];
        HologramHead *setup=[[HologramHead alloc] init];
        //: setup.requestPath=@"xlkkqow/sqkqaqNpr";
        setup.user=StringFromLeyData(k_objectLampTitle);
        //: setup.requestType=REQUEST_POST;
        setup.index=REQUEST_POST;
        //: setup.params=@{@"pids":[NSString jsonStringWithObject:pids]};
        setup.pushTimeId=@{StringFromLeyData(kSternName):[NSString recordFemale:pids]};
        
        //: [[AppManager sharedAppManager].dao startRequest:setup withFinishBlock:^(TalkingRequest *requestModel, NSDictionary *component, NSError *error) {
        [[PlayColorBbbb size].admin with:setup editFee:^(HologramHead *requestModel, NSDictionary *component, NSError *error) {

            //: [subscriber sendNext:component];
            [subscriber sendNext:component];
            //: if (error) {
            if (error) {

                //: [subscriber sendError:error];
                [subscriber sendError:error];
            //: }else{
            }else{
                
                //: [[AppManager sharedAppManager].loginUser updateProfileFullWith:component[@"data"]];
                [[PlayColorBbbb size].file size:component[StringFromLeyData(kDecisionName)]];
                //: [self.deleteGalleryArray removeAllObjects];
                [self.summate removeAllObjects];
                //: [subscriber sendCompleted];
                [subscriber sendCompleted];
            }
        //: }];
        }];
    //: }];
    }];
    //: return deleteSignal;
    return deleteSignal;
}
//: - (RACSignal*)uploadSignal:(LFCGalleryModel*)model{
- (RACSignal*)view:(GalleryModel*)model{
    
    //: RACSignal *uploadSignal = [self createSignal:^(id<RACSubscriber> subscriber) {
    RACSignal *uploadSignal = [self modelSignal:^(id<RACSubscriber> subscriber) {
        
        //: [Helper backgroundCompressImage:model.cacheImage toFileSize:2048 finishBlock:^(NSData *resultData) {
        [WritingGrantBbbb cancel:model.cacheImage title:2048 present:^(NSData *resultData) {
            //: if (!resultData) {
            if (!resultData) {
                //: [subscriber sendCompleted];
                [subscriber sendCompleted];
                //: return;
                return;
            }
            //: TalkingRequest *setup=[[TalkingRequest alloc] init];
            HologramHead *setup=[[HologramHead alloc] init];
            //: setup.requestPath=@"xlkkqow/tnkzls";
            setup.user=StringFromLeyData(kCuriousContent);
            //: setup.requestType=REQUEST_POST;
            setup.index=REQUEST_POST;
            //: setup.params=@{@"pic":resultData};
            setup.pushTimeId=@{StringFromLeyData(kDemographicContent):resultData};
            
            //: [[AppManager sharedAppManager].dao startRequest:setup containingBinaryData:YES withFinishBlock:^(TalkingRequest *requestModel, NSDictionary *component, NSError *error) {
            [[PlayColorBbbb size].admin key:setup withFrom:YES cellBlock:^(HologramHead *requestModel, NSDictionary *component, NSError *error) {
                
                //: [subscriber sendNext:component];
                [subscriber sendNext:component];
                
                //: if (error) {
                if (error) {
                    //: [subscriber sendError:error];
                    [subscriber sendError:error];
                    //: if (component && error.code != 0) {
                    if (component && error.code != 0) {
                        //: model.status = GJGalleryStatusRejected;
                        model.status = GJGalleryStatusRejected;
                    }
                //: }else{
                }else{
                    
                    //: [[AppManager sharedAppManager].loginUser updateProfileFullWith:component[@"data"]];
                    [[PlayColorBbbb size].file size:component[StringFromLeyData(kDecisionName)]];
                    
                    //: LFCGalleryModel *resultModel = [LFCGalleryModel modelWithDic:component[@"data"]];
                    GalleryModel *resultModel = [GalleryModel notice:component[StringFromLeyData(kDecisionName)]];
                    //: model.id = resultModel.id;
                    model.id = resultModel.id;
                    //: model.url = resultModel.url;
                    model.url = resultModel.url;
                    //: model.status = resultModel.status;
                    model.status = resultModel.status;
                    //: [subscriber sendCompleted];
                    [subscriber sendCompleted];
                }
            //: }];
            }];
            
        //: }];
        }];
    //: }];
    }];
    //: return uploadSignal;
    return uploadSignal;
}

// 重排相册图片
//: - (void)func__resortAction{
- (void)cancel{
  
    //: NSMutableArray<NSString*> *pids = [[NSMutableArray alloc] init];
    NSMutableArray<NSString*> *pids = [[NSMutableArray alloc] init];
    //: [self.galleryArray enumerateObjectsUsingBlock:^(LFCGalleryModel * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
    [self.edit enumerateObjectsUsingBlock:^(GalleryModel * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
        //: if (obj.id <= 0) {
        if (obj.id <= 0) {
            //: return ;
            return ;
        }
        //: [pids addObject:[NSString stringWithFormat:@"%zd",obj.id]];
        [pids addObject:[NSString stringWithFormat:@"%zd",obj.id]];
    //: }];
    }];
    
    //: if (pids.count == 0) {
    if (pids.count == 0) {
        
        //: [Helper dispatchInMainQueue:^{
        [WritingGrantBbbb of:^{
            
            //: self.currentTaskIndex++;
            self.buildStatus++;
            //: self.hud.label.text = [NSString stringWithFormat:@"(%.0f%%)保存中...",self.currentTaskIndex*100.0/self.taskNumber];
            self.sex.label.text = [NSString stringWithFormat:StringFromLeyData(kBraveOldenName),self.buildStatus*100.0/self.imageCancel];
            //: [MBProgressHUD hideHUDForView:[UIApplication sharedApplication].delegate.window animated:YES];
            [MBProgressHUD hideHUDForView:[UIApplication sharedApplication].delegate.window animated:YES];
            
            //: if (self.galleryDidChangeBlock) {
            if (self.day) {
                //: self.galleryDidChangeBlock([self.galleryArray mutableCopy]);
                self.day([self.edit mutableCopy]);
            }
            //: [self showStatusBarSuccessStr:(@"保存成功")];
            [self remark:(StringFromLeyData(k_suddenMiteWithName))];
            //: [self.navigationController popViewControllerAnimated:YES];
            [self.navigationController popViewControllerAnimated:YES];
        //: }];
        }];
        //: return;
        return;
    }
    
    //: TalkingRequest *setup=[[TalkingRequest alloc] init];
    HologramHead *setup=[[HologramHead alloc] init];
    //: setup.requestPath=@"xlkkqow/oqizoaNpr";
    setup.user=StringFromLeyData(kViewTimeName);
    //: setup.requestType=REQUEST_POST;
    setup.index=REQUEST_POST;
    //: setup.params=@{@"pids":[NSString jsonStringWithObject:pids]};
    setup.pushTimeId=@{StringFromLeyData(kSternName):[NSString recordFemale:pids]};
    //: @weakify(self);
    @weakify(self);
    //: [[AppManager sharedAppManager].dao startRequest:setup withFinishBlock:^(TalkingRequest *requestModel, NSDictionary *component, NSError *error) {
    [[PlayColorBbbb size].admin with:setup editFee:^(HologramHead *requestModel, NSDictionary *component, NSError *error) {
        //: @strongify(self);
        @strongify(self);
        
        //: [Helper dispatchInMainQueue:^{
        [WritingGrantBbbb of:^{
            //: self.currentTaskIndex++;
            self.buildStatus++;
            //: self.hud.label.text = [NSString stringWithFormat:@"(%.0f%%)保存中...",self.currentTaskIndex*100.0/self.taskNumber];
            self.sex.label.text = [NSString stringWithFormat:StringFromLeyData(kBraveOldenName),self.buildStatus*100.0/self.imageCancel];
            //: [MBProgressHUD hideHUDForView:[UIApplication sharedApplication].delegate.window animated:YES];
            [MBProgressHUD hideHUDForView:[UIApplication sharedApplication].delegate.window animated:YES];
        //: }];
        }];
        
        //: if (error) {
        if (error) {
            //: [self showError:error];
            [self target:error];
        //: }else{
        }else{
            //: if (self.galleryDidChangeBlock) {
            if (self.day) {
                //: self.galleryDidChangeBlock([self.galleryArray mutableCopy]);
                self.day([self.edit mutableCopy]);
            }
            //: [self showStatusBarSuccessStr:(@"保存成功")];
            [self remark:(StringFromLeyData(k_suddenMiteWithName))];
            //: [self.navigationController popViewControllerAnimated:YES];
            [self.navigationController popViewControllerAnimated:YES];
        }
    //: }];
    }];
}
//: - (void)batchUpload:(NSMutableArray<NSMutableArray<RACSignal*>*> *)signalGroupArray complete:(void(^)(NSError*))completeBlock{
- (void)managerAdminList:(NSMutableArray<NSMutableArray<RACSignal*>*> *)signalGroupArray identity:(void(^)(NSError*))completeBlock{
    //: if (signalGroupArray.count == 0) {
    if (signalGroupArray.count == 0) {
        //: if (completeBlock) {
        if (completeBlock) {
            //: completeBlock(nil);
            completeBlock(nil);
        }
        //: return;
        return;
    }
    //: NSMutableArray<RACSignal*> *signalGroup = [signalGroupArray additions_pop];
    NSMutableArray<RACSignal*> *signalGroup = [signalGroupArray request];
    //: [[RACSignal merge:signalGroup] subscribeNext:^(id x) {
    [[RACSignal merge:signalGroup] subscribeNext:^(id x) {
        
    //: } error:^(NSError *error) {
    } error:^(NSError *error) {
        //: if (completeBlock) {
        if (completeBlock) {
            //: completeBlock(error);
            completeBlock(error);
        }
    //: } completed:^{
    } completed:^{
        
        //: self.currentTaskIndex++;
        self.buildStatus++;
        //: self.hud.label.text = [NSString stringWithFormat:@"(%.0f%%)保存中...",self.currentTaskIndex*100.0/self.taskNumber];
        self.sex.label.text = [NSString stringWithFormat:StringFromLeyData(kBraveOldenName),self.buildStatus*100.0/self.imageCancel];
        //: [self batchUpload:signalGroupArray complete:completeBlock];
        [self managerAdminList:signalGroupArray identity:completeBlock];
    //: }];
    }];
}
//: - (void)saveAction:(id)sender{
- (void)analogDigitalConverter:(id)sender{
    
    //: [LFCAppCapStatistical onNewEvent:[LFCAppStatHelper clickSaveButtonInPhotoAlbumPage]];
    [AppBbbb userBbbb:[ClickUser city]];
    
    //: [Helper dispatchInMainQueue:^{
    [WritingGrantBbbb of:^{
        
        //: if (self.hud) {
        if (self.sex) {
            //: [MBProgressHUD hideHUDForView:[UIApplication sharedApplication].delegate.window animated:NO];
            [MBProgressHUD hideHUDForView:[UIApplication sharedApplication].delegate.window animated:NO];
            //: self.hud = nil;
            self.sex = nil;
        }
        
        //: self.hud = [MBProgressHUD showHUDAddedTo:[UIApplication sharedApplication].delegate.window animated:YES];
        self.sex = [MBProgressHUD showHUDAddedTo:[UIApplication sharedApplication].delegate.window animated:YES];
        //: self.hud.label.text = [NSString stringWithFormat:@"(%.0f%%)保存中...",0.0];
        self.sex.label.text = [NSString stringWithFormat:StringFromLeyData(kBraveOldenName),0.0];
    //: }];
    }];
    
    //: NSMutableArray<NSNumber*> *rejectedIndexArray = [[NSMutableArray alloc] init];
    NSMutableArray<NSNumber*> *rejectedIndexArray = [[NSMutableArray alloc] init];
    //: [self.galleryArray enumerateObjectsUsingBlock:^(LFCGalleryModel * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
    [self.edit enumerateObjectsUsingBlock:^(GalleryModel * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
        //: if (obj.status == GJGalleryStatusRejected) {
        if (obj.status == GJGalleryStatusRejected) {
            //: [rejectedIndexArray addObject:@(idx)];
            [rejectedIndexArray addObject:@(idx)];
        }
    //: }];
    }];
    
    //: [rejectedIndexArray enumerateObjectsUsingBlock:^(NSNumber * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
    [rejectedIndexArray enumerateObjectsUsingBlock:^(NSNumber * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
        //: [self.galleryArray removeObjectAtIndex:obj.integerValue];
        [self.edit removeObjectAtIndex:obj.integerValue];
    //: }];
    }];
    
    //: [Helper dispatchInMainQueue:^{
    [WritingGrantBbbb of:^{
        //: [self.collectionView reloadData];
        [self.makeBe reloadData];
    //: }];
    }];
    
    
    //upload prepare
    //: NSInteger maxNumberOfRequest = 1;
    NSInteger maxNumberOfRequest = 1;
    
    //: NSInteger numberOfRequest = 0;
    NSInteger numberOfRequest = 0;
    //: NSMutableArray<NSMutableArray<RACSignal*>*> *signalGroupArray = [[NSMutableArray alloc] init];
    NSMutableArray<NSMutableArray<RACSignal*>*> *signalGroupArray = [[NSMutableArray alloc] init];
    //: NSMutableArray<RACSignal*> *signalGroup = [[NSMutableArray alloc] init];
    NSMutableArray<RACSignal*> *signalGroup = [[NSMutableArray alloc] init];
    //: for (LFCGalleryModel* model in self.galleryArray) {
    for (GalleryModel* model in self.edit) {
        //: if (model.id == 0 &&
        if (model.id == 0 &&
            //: model.cacheImage ) {
            model.cacheImage ) {
            //: if (numberOfRequest == maxNumberOfRequest) {
            if (numberOfRequest == maxNumberOfRequest) {
                //: [signalGroupArray addObject:signalGroup];
                [signalGroupArray addObject:signalGroup];
                //: signalGroup = [[NSMutableArray alloc] init];
                signalGroup = [[NSMutableArray alloc] init];
                //: numberOfRequest = 0;
                numberOfRequest = 0;
            }
            //: [signalGroup addObject:[self uploadSignal:model]];
            [signalGroup addObject:[self view:model]];
            //: numberOfRequest ++;
            numberOfRequest ++;
        }
    }
    //: if (signalGroup.count > 0) {
    if (signalGroup.count > 0) {
        //: [signalGroupArray addObject:signalGroup];
        [signalGroupArray addObject:signalGroup];
    }
    //: self.currentTaskIndex = 0;
    self.buildStatus = 0;
    //: self.taskNumber = 1 + signalGroupArray.count + 1;
    self.imageCancel = 1 + signalGroupArray.count + 1;
    //: self.hud.label.text = [NSString stringWithFormat:@"(%.0f%%)保存中...",self.currentTaskIndex*100.0/self.taskNumber];
    self.sex.label.text = [NSString stringWithFormat:StringFromLeyData(kBraveOldenName),self.buildStatus*100.0/self.imageCancel];
    //delete
    //: @weakify(self);
    @weakify(self);
    //: RACSignal *deleteSignal = [self deleteSignal];
    RACSignal *deleteSignal = [self saySignalIcon];
    //: [deleteSignal subscribeNext:^(id x) {
    [deleteSignal subscribeNext:^(id x) {
    //: } error:^(NSError *error) {
    } error:^(NSError *error) {
        //: @strongify(self);
        @strongify(self);
        //: [self showError:error];
        [self target:error];
        //: [Helper dispatchInMainQueue:^{
        [WritingGrantBbbb of:^{
            //: [MBProgressHUD hideHUDForView:[UIApplication sharedApplication].delegate.window animated:YES];
            [MBProgressHUD hideHUDForView:[UIApplication sharedApplication].delegate.window animated:YES];
        //: }];
        }];
    //: } completed:^{
    } completed:^{
        //upload
        //: @strongify(self);
        @strongify(self);
        //: if (self.galleryDidChangeBlock) {
        if (self.day) {
            //: self.galleryDidChangeBlock([self.galleryArray mutableCopy]);
            self.day([self.edit mutableCopy]);
        }
        //: self.currentTaskIndex++;
        self.buildStatus++;
        //: [Helper dispatchInMainQueue:^{
        [WritingGrantBbbb of:^{
            //: NSLog(@"%@主线程",[[NSThread currentThread] isMainThread] ? @"是" : @"不是");
            //: self.hud.label.text = [NSString stringWithFormat:@"(%.0f%%)保存中...",self.currentTaskIndex*100.0/self.taskNumber];
            self.sex.label.text = [NSString stringWithFormat:StringFromLeyData(kBraveOldenName),self.buildStatus*100.0/self.imageCancel];
        //: }];
        }];
        //: @weakify(self);
        @weakify(self);
        //: [self batchUpload:signalGroupArray complete:^(NSError *error) {
        [self managerAdminList:signalGroupArray identity:^(NSError *error) {
            //: @strongify(self);
            @strongify(self);
            //: if (error) {
            if (error) {
                //: [self showError:error];
                [self target:error];
                //: [Helper dispatchInMainQueue:^{
                [WritingGrantBbbb of:^{
                    //: [MBProgressHUD hideHUDForView:[UIApplication sharedApplication].delegate.window animated:YES];
                    [MBProgressHUD hideHUDForView:[UIApplication sharedApplication].delegate.window animated:YES];
                //: }];
                }];
                //: [self.collectionView reloadData];
                [self.makeBe reloadData];
                
            //: }else{
            }else{
                
                //: if (self.galleryDidChangeBlock) {
                if (self.day) {
                    //: self.galleryDidChangeBlock([self.galleryArray mutableCopy]);
                    self.day([self.edit mutableCopy]);
                }
                //sort
                //: [self func__resortAction];
                [self cancel];
            }
        //: }];
        }];
    //: }];
    }];
}
//: - (void)previewAction:(NSUInteger)index{
- (void)follow:(NSUInteger)index{
    
    //: NSMutableArray<LFCImagePreviewModel*> *previewModelArray = [NSMutableArray new];
    NSMutableArray<CloudRidModel*> *previewModelArray = [NSMutableArray new];
    //: [self.galleryArray enumerateObjectsUsingBlock:^(LFCGalleryModel * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
    [self.edit enumerateObjectsUsingBlock:^(GalleryModel * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
        //: NSMutableDictionary *dic = [NSMutableDictionary new];
        NSMutableDictionary *dic = [NSMutableDictionary new];
        //: if (obj.url) {
        if (obj.url) {
            //: dic[@"url"] = obj.url;
            dic[StringFromLeyData(k_highwayFlueAttitudeName)] = obj.url;
        }
        //: if (obj.cacheImage) {
        if (obj.cacheImage) {
            //: dic[@"image"] = obj.cacheImage;
            dic[StringFromLeyData(k_heliText)] = obj.cacheImage;
        }
        //: [previewModelArray addObject:[LFCImagePreviewModel modelWithDic:dic]];
        [previewModelArray addObject:[CloudRidModel notice:dic]];
     //: }];
     }];
    
    //: LFCImagePreviewController *previewController = [[LFCImagePreviewController alloc] init];
    IdentityControllerBbbb *previewController = [[IdentityControllerBbbb alloc] init];

    //: previewController.photos = previewModelArray;
    previewController.door = previewModelArray;
    //: previewController.currentPhotoIndex = index;
    previewController.pseudonym = index;
    //: previewController.showDeleteButton = self.type == GJAlbumTypeEnableEdit;
    previewController.pathOpen = self.kick == GJAlbumTypeEnableEdit;
    //: @weakify(self);
    @weakify(self);
    //: [previewController setdeleteImageBlock:^(NSInteger index){
    [previewController setVocalisation:^(NSInteger index){
        //: @strongify(self);
        @strongify(self);
        //: if (self.galleryArray.count > index) {
        if (self.edit.count > index) {
            //: LFCGalleryModel *deleteGalleryModel = [self.galleryArray objectAtIndex:index];
            GalleryModel *deleteGalleryModel = [self.edit objectAtIndex:index];

            //: if (deleteGalleryModel.id > 0) {
            if (deleteGalleryModel.id > 0) {
                //: [self.deleteGalleryArray addObject:deleteGalleryModel];
                [self.summate addObject:deleteGalleryModel];
            }
            //: [self.galleryArray removeObjectAtIndex:index];
            [self.edit removeObjectAtIndex:index];
            
            //: self.hasChange = YES;
            self.halogen = YES;
            //: [self.collectionView reloadData];
            [self.makeBe reloadData];
        }
    //: }];
    }];
    //: [self.navigationController pushViewController:previewController animated:YES];
    [self.navigationController pushViewController:previewController animated:YES];
    
}
//: - (void)func__addImageAction{
- (void)report{
    
    //: [LFCAppCapStatistical onNewEvent:[LFCAppStatHelper clickUploadingButtonInPhotoAlbumPage]];
    [AppBbbb userBbbb:[ClickUser half]];
    //: if (self.galleryArray.count >= kMaxImagesCount) {
    if (self.edit.count >= kMaxImagesCount) {
        //: [Helper showOKAlert:[NSString stringWithFormat:@"最多只能选择%d张照片",kMaxImagesCount] block:nil];
        [WritingGrantBbbb imageMessage:[NSString stringWithFormat:StringFromLeyData(k_quitBooValue),kMaxImagesCount] petitionSend:nil];
        //: return;
        return;
    }
    //: @weakify(self);
    @weakify(self);
    //: [LFCPhotoChoiceTool initimagePickerFromVc:self
    [RidBbbb initShow:self
                                     //: MaxCount:kMaxImagesCount-self.galleryArray.count
                                     overInfoBbbb:kMaxImagesCount-self.edit.count
                                 //: isAllowPhoto:YES
                                 filtrateBbbb:YES
                                     //: imgBlock:^(NSArray<UIImage *> * _Nonnull photos) {
                                     video:^(NSArray<UIImage *> * _Nonnull photos) {
        //: @strongify(self);
        @strongify(self);
        //: [self didSelectImageArray:photos];
        [self duringReceive:photos];
    //: }];
    }];
}

//: - (void)didSelectImageArray:(NSArray<UIImage*>*)imageArray{
- (void)duringReceive:(NSArray<UIImage*>*)imageArray{
    
    //: [imageArray enumerateObjectsUsingBlock:^(UIImage * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
    [imageArray enumerateObjectsUsingBlock:^(UIImage * _Nonnull obj, NSUInteger idx, BOOL * _Nonnull stop) {
        
        //: LFCGalleryModel *model = [LFCGalleryModel modelWithDic:@{}];
        GalleryModel *model = [GalleryModel notice:@{}];
        //: model.cacheImage = obj;
        model.cacheImage = obj;
        //: [self.galleryArray addObject:model];
        [self.edit addObject:model];
        //: self.hasChange = YES;
        self.halogen = YES;
    //: }];
    }];
    
    //: [self.collectionView reloadData];
    [self.makeBe reloadData];
}


//: #pragma mark - collectionView delegate
#pragma mark - collectionView delegate

//: - (NSInteger)numberOfSectionsInCollectionView:(UICollectionView *)collectionView{
- (NSInteger)numberOfSectionsInCollectionView:(UICollectionView *)collectionView{
    //: return 1;
    return 1;
}
//: - (NSInteger)collectionView:(UICollectionView *)theCollectionView numberOfItemsInSection:(NSInteger)theSectionIndex {
- (NSInteger)collectionView:(UICollectionView *)theCollectionView numberOfItemsInSection:(NSInteger)theSectionIndex {
    //: if (self.type == GJAlbumTypeEnableEdit) {
    if (self.kick == GJAlbumTypeEnableEdit) {
        //: return self.galleryArray.count+1;
        return self.edit.count+1;
    //: }else{
    }else{
        //: return self.galleryArray.count;
        return self.edit.count;
    }
}

//: - (UICollectionViewCell *)collectionView:(UICollectionView *)collectionView cellForItemAtIndexPath:(NSIndexPath *)indexPath {
- (UICollectionViewCell *)collectionView:(UICollectionView *)collectionView cellForItemAtIndexPath:(NSIndexPath *)indexPath {
    //: LFCGalleryCCell *ccell = [collectionView dequeueReusableCellWithReuseIdentifier:[RowBbbb LFCGalleryCCellID] forIndexPath:indexPath];
    GalleryUpBbbbView *ccell = [collectionView dequeueReusableCellWithReuseIdentifier:[RowBbbb filterTo] forIndexPath:indexPath];
    //: if (self.type == GJAlbumTypeEnableEdit) {
    if (self.kick == GJAlbumTypeEnableEdit) {
        //: if (indexPath.item == 0) {
        if (indexPath.item == 0) {
            //: ccell.galleryModel = nil;
            ccell.phoneEdit = nil;
        //: }else{
        }else{
            //: LFCGalleryModel *galleryModel = self.galleryArray[indexPath.item - 1];
            GalleryModel *galleryModel = self.edit[indexPath.item - 1];
            //: ccell.galleryModel = galleryModel;
            ccell.phoneEdit = galleryModel;
        }
    //: }else{
    }else{
        //: LFCGalleryModel *galleryModel = self.galleryArray[indexPath.item];
        GalleryModel *galleryModel = self.edit[indexPath.item];
        //: ccell.galleryModel = galleryModel;
        ccell.phoneEdit = galleryModel;
    }
    //: return ccell;
    return ccell;
}

//: - (CGSize)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout *)collectionViewLayout sizeForItemAtIndexPath:(NSIndexPath *)indexPath{
- (CGSize)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout *)collectionViewLayout sizeForItemAtIndexPath:(NSIndexPath *)indexPath{
    //: return [LFCGalleryCCell sizeForCollectionViewCell];
    return [GalleryUpBbbbView agoAnswer];
}

//: - (void)collectionView:(UICollectionView *)collectionView didSelectItemAtIndexPath:(NSIndexPath *)indexPath{
- (void)collectionView:(UICollectionView *)collectionView didSelectItemAtIndexPath:(NSIndexPath *)indexPath{
    //: if (self.type == GJAlbumTypeEnableEdit) {
    if (self.kick == GJAlbumTypeEnableEdit) {
        
        //: if (indexPath.item == 0) {
        if (indexPath.item == 0) {
            //: [self func__addImageAction];
            [self report];
        //: }else{
        }else{
            //: [self previewAction:indexPath.item - 1];
            [self follow:indexPath.item - 1];
        }
    //: }else{
    }else{
        //: [self previewAction:indexPath.item];
        [self follow:indexPath.item];
    }
}
//: - (CGFloat)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout*)collectionViewLayout minimumLineSpacingForSectionAtIndex:(NSInteger)section{
- (CGFloat)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout*)collectionViewLayout minimumLineSpacingForSectionAtIndex:(NSInteger)section{
    //: return 5;
    return 5;
}
//: - (CGFloat)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout*)collectionViewLayout minimumInteritemSpacingForSectionAtIndex:(NSInteger)section{
- (CGFloat)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout*)collectionViewLayout minimumInteritemSpacingForSectionAtIndex:(NSInteger)section{
    //: return 5;
    return 5;
}
//: - (UIEdgeInsets)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout*)collectionViewLayout insetForSectionAtIndex:(NSInteger)section;{
- (UIEdgeInsets)collectionView:(UICollectionView *)collectionView layout:(UICollectionViewLayout*)collectionViewLayout insetForSectionAtIndex:(NSInteger)section;{
    //: return UIEdgeInsetsMake(10, 5, 0, 5);
    return UIEdgeInsetsMake(10, 5, 0, 5);
}

//: #pragma mark - LXReorderableCollectionViewDataSource methods
#pragma mark - ReleaseBbbb methods
//: - (void)collectionView:(UICollectionView *)collectionView itemAtIndexPath:(NSIndexPath *)fromIndexPath willMoveToIndexPath:(NSIndexPath *)toIndexPath {
- (void)outsideWith:(UICollectionView *)collectionView version:(NSIndexPath *)fromIndexPath nag:(NSIndexPath *)toIndexPath {
    //: LFCGalleryModel *galleryModel = self.galleryArray[fromIndexPath.item - 1];
    GalleryModel *galleryModel = self.edit[fromIndexPath.item - 1];
    
    //: [self.galleryArray removeObjectAtIndex:fromIndexPath.item - 1];
    [self.edit removeObjectAtIndex:fromIndexPath.item - 1];
    //: [self.galleryArray insertObject:galleryModel atIndex:toIndexPath.item - 1];
    [self.edit insertObject:galleryModel atIndex:toIndexPath.item - 1];
    //: self.hasChange = YES;
    self.halogen = YES;
}
//: - (BOOL)collectionView:(UICollectionView *)collectionView canMoveItemAtIndexPath:(NSIndexPath *)indexPath {
- (BOOL)collectionView:(UICollectionView *)collectionView canMoveItemAtIndexPath:(NSIndexPath *)indexPath {
    //: if (indexPath.item == 0) {
    if (indexPath.item == 0) {
        //: return NO;
        return NO;
    }
    //: return YES;
    return YES;
}

//: - (BOOL)collectionView:(UICollectionView *)collectionView itemAtIndexPath:(NSIndexPath *)fromIndexPath canMoveToIndexPath:(NSIndexPath *)toIndexPath {
- (BOOL)indexTo:(UICollectionView *)collectionView birdSEyeView:(NSIndexPath *)fromIndexPath beWith:(NSIndexPath *)toIndexPath {
    //: if (toIndexPath.item == 0) {
    if (toIndexPath.item == 0) {
        //: return NO;
        return NO;
    }
    //: return YES;
    return YES;
}


//: #pragma mark - lazy init
#pragma mark - lazy init
//: - (UICollectionView *)collectionView{
- (UICollectionView *)makeBe{
    
    //: if (!_collectionView) {
    if (!_makeBe) {
        //: id layout;
        id layout;
        //: if (self.type == GJAlbumTypeEnableEdit) {
        if (self.kick == GJAlbumTypeEnableEdit) {
            //: layout = [[LXReorderableCollectionViewFlowLayout alloc] init];
            layout = [[Current alloc] init];
        //: }else{
        }else{
            //: layout = [[UICollectionViewFlowLayout alloc] init];
            layout = [[UICollectionViewFlowLayout alloc] init];
        }
        //: _collectionView=[[UICollectionView alloc]initWithFrame:self.view.bounds collectionViewLayout:layout];
        _makeBe=[[UICollectionView alloc]initWithFrame:self.view.bounds collectionViewLayout:layout];
        //: _collectionView.backgroundColor =[UIColor whiteColor];
        _makeBe.backgroundColor =[UIColor whiteColor];
        //: _collectionView.delegate = self;
        _makeBe.delegate = self;
        //: _collectionView.dataSource = self;
        _makeBe.dataSource = self;
        //: [_collectionView registerClass:[LFCGalleryCCell class] forCellWithReuseIdentifier:[RowBbbb LFCGalleryCCellID]];
        [_makeBe registerClass:[GalleryUpBbbbView class] forCellWithReuseIdentifier:[RowBbbb filterTo]];
        //: [self.view addSubview:_collectionView];
        [self.view addSubview:_makeBe];
        //: [_collectionView mas_makeConstraints:^(MASConstraintMaker *make) {
        [_makeBe mas_makeConstraints:^(MASConstraintMaker *make) {
            //: make.edges.equalTo(self.view);
            make.edges.equalTo(self.view);
        //: }];
        }];
    }
    //: return _collectionView;
    return _makeBe;
}
//: - (NSMutableArray<LFCGalleryModel*> *)deleteGalleryArray{
- (NSMutableArray<GalleryModel*> *)summate{
    
    //: if (!_deleteGalleryArray) {
    if (!_summate) {
        //: _deleteGalleryArray = [[NSMutableArray alloc] init];
        _summate = [[NSMutableArray alloc] init];
    }
    //: return _deleteGalleryArray;
    return _summate;
}
//: - (NSMutableArray<LFCGalleryModel*> *)galleryArray{
- (NSMutableArray<GalleryModel*> *)edit{
    
    //: if (!_galleryArray) {
    if (!_edit) {
        //: _galleryArray = [[NSMutableArray alloc] init];
        _edit = [[NSMutableArray alloc] init];
    }
    //: return _galleryArray;
    return _edit;
}
//: @end
@end

Byte * LeyDataToCache(Byte *data) {
    int provinceMated = data[0];
    int deemWalking = data[1];
    Byte alienBran = data[2];
    int tee = data[3];
    if (!provinceMated) return data + tee;
    for (int i = tee; i < tee + deemWalking; i++) {
        int value = data[i] + alienBran;
        if (value > 255) {
            value -= 256;
        }
        data[i] = value;
    }
    data[0] = 0;
    data[tee + deemWalking] = 0;
    return data + tee;
}

NSString *StringFromLeyData(Byte *data) {
    return [NSString stringWithUTF8String:(char *)LeyDataToCache(data)];
}
