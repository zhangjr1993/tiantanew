
#import <Foundation/Foundation.h>
typedef struct {
    Byte fillSexual;
    Byte *enjoyAttack;
    unsigned int studyCool;
    bool admire;
	int tine;
	int judgment;
	int ether;
} SupplantingPic;

NSString *StringFromChartData(SupplantingPic *data);



SupplantingPic kPaperTitle = (SupplantingPic){243, (Byte []){22, 118, 91, 21, 101, 116, 126}, 6, false, 16, 91, 252};



SupplantingPic k_mirrorValue = (SupplantingPic){104, (Byte []){10, 28, 6, 4, 28, 35, 7, 94, 10, 55, 13, 3, 1, 4, 55, 13, 26, 7, 5, 55, 27, 28, 6, 13, 5, 7, 5, 55, 6, 7, 26, 215}, 31, false, 52, 252, 169};



SupplantingPic kMagData = (SupplantingPic){186, (Byte []){215, 213, 215, 223, 212, 206, 243, 222, 189}, 8, false, 156, 72, 107};



SupplantingPic k_wordTitle = (SupplantingPic){254, (Byte []){25, 89, 127, 26, 65, 95, 14}, 6, false, 137, 60, 67};



SupplantingPic k_compromiseValue = (SupplantingPic){139, (Byte []){233, 255, 229, 251, 190, 186, 255, 221, 210, 212, 238, 224, 226, 231, 212, 248, 255, 229, 238, 230, 228, 230, 212, 251, 249, 238, 180}, 26, false, 219, 33, 183};



SupplantingPic k_hmValue = (SupplantingPic){80, (Byte []){38, 57, 52, 53, 63, 1, 97, 58, 98, 61, 21, 15, 36, 62, 53, 61, 63, 61, 15, 50, 63, 36, 36, 63, 61, 188}, 25, false, 146, 228, 37};



SupplantingPic k_etherPossibleText = (SupplantingPic){63, (Byte []){86, 76, 120, 77, 90, 90, 75, 186}, 7, false, 158, 47, 127};



SupplantingPic kSodiumAntiData = (SupplantingPic){113, (Byte []){24, 2, 61, 24, 26, 20, 123}, 6, false, 176, 132, 69};



SupplantingPic k_fishermanData = (SupplantingPic){121, (Byte []){27, 13, 23, 18, 27, 13, 14, 50, 59, 38, 28, 11, 22, 20, 38, 10, 13, 23, 28, 20, 22, 20, 38, 26, 22, 20, 20, 28, 23, 13, 179}, 30, false, 112, 167, 155};



SupplantingPic kHaveName = (SupplantingPic){67, (Byte []){171, 236, 199, 171, 237, 249, 58}, 6, false, 202, 129, 215};



SupplantingPic k_currentPianoContent = (SupplantingPic){250, (Byte []){157, 136, 159, 159, 142, 74}, 5, false, 127, 202, 43};



SupplantingPic k_sophisticatedPollName = (SupplantingPic){242, (Byte []){134, 157, 167, 155, 150, 129, 18}, 6, false, 233, 86, 168};



SupplantingPic k_heartTitle = (SupplantingPic){229, (Byte []){145, 156, 149, 128, 143}, 4, false, 226, 162, 157};



SupplantingPic kFindingName = (SupplantingPic){1, (Byte []){230, 131, 184, 233, 180, 159, 213}, 6, false, 199, 51, 175};



SupplantingPic k_bunHerselfValue = (SupplantingPic){156, (Byte []){254, 232, 242, 216, 173, 221, 216, 253, 174, 195, 245, 244, 195, 239, 248, 242, 249, 245, 238, 250, 195, 242, 243, 238, 141}, 24, false, 201, 16, 147};



SupplantingPic kTreeTitle = (SupplantingPic){113, (Byte []){22, 3, 20, 20, 5, 95, 2, 7, 22, 16, 176}, 10, false, 175, 243, 125};



SupplantingPic kCostumeText = (SupplantingPic){238, (Byte []){130, 135, 133, 139, 243}, 4, false, 23, 232, 135};



SupplantingPic k_admireText = (SupplantingPic){254, (Byte []){156, 138, 144, 164, 149, 204, 188, 173, 143, 161, 155, 140, 145, 147, 161, 141, 138, 144, 155, 147, 145, 147, 161, 147, 155, 141, 141, 159, 153, 155, 233}, 30, false, 71, 75, 222};

















// __M_A_C_R_O__
#import "FinishUserView.h"
#import "UpBbbb.h"
#import "GibbetViewController.h"
#import <SVGAPlayer/SVGA.h>

static const NSInteger contentLableLineHeight = 26;


@interface FinishUserView ()<SVGAPlayerDelegate>


@property (nonatomic, strong) ExampleJsonModel *red;


@property (nonatomic, strong) UILabel *bind;



@property (nonatomic, strong) AtControl *modern;



@property (nonatomic, strong) AtControl *giveaway;



@property (nonatomic, strong) AtControl *decease;



@property (nonatomic, strong) AtControl *image;



@property (nonatomic, strong) AtControl *entranceLFCButton;


@property (nonatomic, strong) UIImageView *statusView;



@end


@implementation FinishUserView


-(instancetype)initWithFrame:(CGRect)frame{
    
    self = [super initWithFrame:frame];
    
    if (self) {
        
        self.backgroundColor = [[ShowColor current] colorWithAlphaComponent:0.8];
        
        [self quickBbbb];
    }
    
    return self;
}


- (void)quickBbbb{
    
    [self addSubview:self.statusView];

    
    [self.bind mas_makeConstraints:^(MASConstraintMaker *make) {
        
        make.top.mas_equalTo(12);
        
        make.left.mas_equalTo(15);
        
        make.right.mas_equalTo(-15);

    
    }];

    
    [self.modern mas_makeConstraints:^(MASConstraintMaker *make) {
        
        make.top.mas_equalTo(self.bind.mas_bottom).mas_equalTo(0);
        
        make.left.mas_equalTo(15);
        
        make.width.mas_equalTo(30);
        
        make.height.mas_equalTo(20);
    
    }];

    
    [self.giveaway mas_makeConstraints:^(MASConstraintMaker *make) {
        
        make.bottom.mas_equalTo(-(20+safeAreaBottomHeight()));
        
        make.left.mas_equalTo(15);
        
        make.size.mas_equalTo(CGSizeMake(58, 24));
    
    }];

    
    [self.decease mas_makeConstraints:^(MASConstraintMaker *make) {
        
        make.centerY.mas_equalTo(self.giveaway);
        
        make.left.mas_equalTo(self.giveaway.mas_right).mas_equalTo(24);
        
        make.size.mas_equalTo(CGSizeMake(58, 24));
    
    }];

    
    [self.image mas_makeConstraints:^(MASConstraintMaker *make) {
        
        make.centerY.mas_equalTo(self.giveaway);
        
        make.left.mas_equalTo(self.decease.mas_right).mas_equalTo(24);
        
        make.size.mas_equalTo(CGSizeMake(58, 24));
    
    }];

    
    [self.entranceLFCButton mas_makeConstraints:^(MASConstraintMaker *make) {
        
        make.right.mas_equalTo(-15);
        
        make.centerY.mas_equalTo(self.giveaway);
        
        make.width.mas_equalTo(84);
        
        make.height.mas_equalTo(30);
    
    }];
}


- (void)config:(ExampleJsonModel *)model{
    
    _red = model;

    
    self.entranceLFCButton.selected = model.isManualGreet;
    
    self.giveaway.selected = model.isLike;

    
    if ([PlayColorBbbb size].file.id == model.uid) {
        
        self.entranceLFCButton.hidden = YES;
        
        self.image.hidden = YES;
    
    }else{
        
        self.entranceLFCButton.hidden = NO;
        
        self.image.hidden = NO;
    }

    
    if ([PlayColorBbbb size].itemImage) {
        
        self.entranceLFCButton.hidden = YES;
    }

    
    
    if (model.content.length > 0) {

        
        self.bind.text = model.content;

        
        CGSize size = [self.bind.text boundingRectWithSize:CGSizeMake(screenWidth() - 30, 0x1.fffffep+127f) options:NSStringDrawingUsesLineFragmentOrigin attributes:@{NSFontAttributeName : [UIFont underbelly:PFSCTypeRegular substance:15]} context:nil].size;

        
        
        NSInteger lineCount = size.height / self.bind.font.lineHeight;
        
        if (lineCount > 2) {
            
            self.modern.hidden = NO;
            
            self.frame = CGRectMake(0, screenHeight()-(self.height+3*contentLableLineHeight), screenWidth(), self.height+3*contentLableLineHeight);
        
        }else{
            
            self.modern.hidden = YES;
            
            self.frame = CGRectMake(0, screenHeight()-(self.height+lineCount*contentLableLineHeight), screenWidth(), self.height+lineCount*contentLableLineHeight);
        }
    }

    
    if (model.momentType == GJMomentTypeVideo) {
        
        self.backgroundColor = UIColor.clearColor;
        
        self.statusView.hidden = NO;
        
        [self.statusView mas_makeConstraints:^(MASConstraintMaker *make) {
            
            make.top.mas_equalTo(-60);
            
            make.left.right.bottom.mas_equalTo(0);
        
        }];
    
    }else{
        
        self.statusView.hidden = YES;
    }

}



#pragma mark - action

- (void)buttonses:(UIButton *)sender{
    
    if (self.control) {
        
        self.control(sender);
    }
    
    switch (sender.tag) {
        
        case 100:
            
            
            [self barPage];
            
            break;
        
        case 101:
            
            
            [self endUser:YES];

            
            break;
        
        case 102:
            
            
            [[PlayColorBbbb size] show:self.red.uid];
            
            break;

        
        case 103:
            
            
            [self cellWishBbbb];
            
            break;
        
        case 104:
            
            
            [self endUser:NO];
            
            break;
        
        default:
            
            break;
    }
}


- (void)endUser:(BOOL)toCommentView{
    
    UIViewController *topVC = [PlayColorBbbb size].vid;

    
    NSArray *vcArray = [PlayColorBbbb size].vid.navigationController.viewControllers;

    
    GibbetViewController *detailVC = [[GibbetViewController alloc]initVideo:self.red.mid];
    
    [detailVC setScene:^{
        
        if (self.curName) {
            
            self.curName(self.red.mid);
        }
    
    }];
    
    detailVC.showView = toCommentView;
    
    for (UIViewController *vc in vcArray) {
        
        if ([vc isKindOfClass:[detailVC class]]) {
            
            [topVC.navigationController popViewControllerAnimated:YES];
            
            return;
        }
    }

    
    [topVC.navigationController pushViewController:detailVC animated:YES];
}


#pragma mark - greet effect

- (void)field{
    
    SVGAParser* parser = [[SVGAParser alloc] init];
    
    NSString *filePath = [UtilBbbb showBbbb:StringFromChartData(&kTreeTitle)];
     
     NSData *data = [NSData dataWithContentsOfFile:filePath];
     
     NSString *key = nil;
    
    SVGAPlayer* player = [self lance];

     
     [parser parseWithData:data cacheKey:key completionBlock:^(SVGAVideoEntity * _Nonnull videoItem) {
         
         if (videoItem) {
             
             player.videoItem = videoItem;
             
             [player startAnimation];
         }
     
     } failureBlock:^(NSError * _Nonnull error) {

     
     }];
}


- (SVGAPlayer*)lance{
    
    SVGAPlayer* greetPlayer = [[SVGAPlayer alloc] initWithFrame:CGRectMake(0, 0, actualWidth(65), actualWidth(65))];
    
    greetPlayer.loops = 1;
    
    greetPlayer.clearsAfterStop = YES;
    
    greetPlayer.delegate = self;
    
    greetPlayer.userInteractionEnabled = NO;
    
    greetPlayer.contentMode = UIViewContentModeScaleToFill;
    
    [self addSubview:greetPlayer];

    
    [greetPlayer mas_makeConstraints:^(MASConstraintMaker *make) {
        
        make.center.equalTo(self.entranceLFCButton);
        
        make.size.mas_equalTo(CGSizeMake(65, 65));
    
    }];

    
    return greetPlayer;
}


- (void)svgaPlayerDidFinishedAnimation:(SVGAPlayer *)player{
    
    [player stopAnimation];
    
    player.hidden = YES;
    
    [player removeFromSuperview];
}


#pragma mark - request


- (void)cellWishBbbb{
    
    NSDictionary *params = @{StringFromChartData(&k_sophisticatedPollName):@(self.red.uid).description,
                             
                             StringFromChartData(&kMagData):@(self.red.mid).description
                            
                            };

    
    [[UpBbbb numerosity] alongStrengthStatus:params with:^(BOOL success, NSError * _Nonnull error) {
        
        if (success) {
            
            self.entranceLFCButton.selected = YES;
            
            self.red.isManualGreet = YES;

            
            BOOL isGreet = YES;
            
            NSDictionary *dict = @{
                
                StringFromChartData(&k_heartTitle):StringFromChartData(&k_currentPianoContent),
                
                StringFromChartData(&k_etherPossibleText):@(isGreet).description,
                
                StringFromChartData(&kMagData):@(self.red.mid).description
            
            };


            
            [[NSNotificationCenter defaultCenter] postNotificationName:[CurrentUp income] object:dict];

        }
    
    }];
}


- (void)barPage{
    
    NSInteger type = self.giveaway.selected ? 2 : 1;
    
    NSDictionary *param = @{
                            
                            StringFromChartData(&kMagData):@(self.red.mid).description,
                            
                            StringFromChartData(&k_heartTitle):@(type).description
                            
                            };

    
    [TrailBucket clockWatchingMobile:param petition:^(NSDictionary * _Nonnull resultDic, NSError * _Nonnull error) {
        
        if (error != nil) {
            
            [self user:error];
            
            return;
        }

        
        self.giveaway.selected = type == 1 ? YES: NO;
        
        self.red.isLike = self.giveaway.selected;

        
        BOOL isLike = self.giveaway.selected;

        
        NSDictionary *dict = @{
            
            StringFromChartData(&k_heartTitle):StringFromChartData(&kCostumeText),
            
            StringFromChartData(&kSodiumAntiData):@(isLike).description,
            
            StringFromChartData(&kMagData):@(self.red.mid).description
        
        };

        
        [[NSNotificationCenter defaultCenter] postNotificationName:[CurrentUp income] object:dict];


    
    }];
}


#pragma mark - lazy load


- (UILabel *)bind{
    
    if (!_bind) {
        
        _bind = [[UILabel alloc] init];
        
        _bind.textColor = UIColor.whiteColor;
        
        _bind.font = [UIFont underbelly:(PFSCTypeRegular) substance:15.0];
        
        _bind.numberOfLines = 2;
        
        [self addSubview:_bind];
    }
    
    return _bind;
}


-(UIButton *)modern{
    
    if (!_modern) {
        
        _modern = [[AtControl alloc]init];
        
        [_modern setTitle:StringFromChartData(&kPaperTitle) forState:UIControlStateNormal];
        
        [_modern setTitleColor:[UIColor colorWithHexString:((__bridge NSString *)CFSTR("#4FAAFF"))] forState:UIControlStateNormal];
        
        _modern.titleLabel.font = [UIFont underbelly:(PFSCTypeRegular) substance:15.0];
        
        _modern.tag = 104;
        
        [_modern addTarget:self action:@selector(buttonses:) forControlEvents:UIControlEventTouchUpInside];
        
        _modern.hidden = YES;
        
        [self addSubview:_modern];
    }
    
    return _modern;
}



-(AtControl *)giveaway{
    
    if (!_giveaway) {
        
        _giveaway = [[AtControl alloc]init];
        
        [_giveaway setTitle:StringFromChartData(&kFindingName) forState:UIControlStateNormal];
        
        [_giveaway setTitleColor:UIColor.whiteColor forState:UIControlStateNormal];
        
        _giveaway.titleLabel.font = [UIFont underbelly:PFSCTypeRegular substance:13];
        
        _giveaway.number = 10;
        
        [_giveaway setImage:[UserTextImage imageNamed:StringFromChartData(&k_mirrorValue)] forState:UIControlStateNormal];
        
        [_giveaway setImage:[UserTextImage imageNamed:StringFromChartData(&k_compromiseValue)] forState:UIControlStateSelected];
        
        _giveaway.tag = 100;
        
        [_giveaway addTarget:self action:@selector(buttonses:) forControlEvents:UIControlEventTouchUpInside];
        
        [self addSubview:_giveaway];
    }
    
    return _giveaway;
}



-(AtControl *)decease{
    
    if (!_decease) {
        
        _decease = [[AtControl alloc]init];
        
        [_decease setImage:[UserTextImage imageNamed:StringFromChartData(&k_fishermanData)] forState:UIControlStateNormal];
        
        [_decease setTitle:StringFromChartData(&kHaveName) forState:UIControlStateNormal];
        
        [_decease setTitleColor:UIColor.whiteColor forState:UIControlStateNormal];
        
        _decease.titleLabel.font = [UIFont underbelly:PFSCTypeRegular substance:13];
        
        _decease.number = 10;
        
        _decease.tag = 101;
        
        [_decease addTarget:self action:@selector(buttonses:) forControlEvents:UIControlEventTouchUpInside];
        
        [self addSubview:_decease];
    }
    
    return _decease;
}


-(AtControl *)image{
    
    if (!_image) {
        
        _image = [[AtControl alloc]init];
        
        [_image setImage:[UserTextImage imageNamed:StringFromChartData(&k_admireText)] forState:UIControlStateNormal];
        
        [_image setTitle:StringFromChartData(&k_wordTitle) forState:UIControlStateNormal];
        
        [_image setTitleColor:UIColor.whiteColor forState:UIControlStateNormal];
        
        _image.titleLabel.font = [UIFont underbelly:PFSCTypeRegular substance:13];
        
        _image.number = 10;
        
        _image.tag = 102;
        
        [_image addTarget:self action:@selector(buttonses:) forControlEvents:UIControlEventTouchUpInside];
        
        [self addSubview:_image];
    }
    
    return _image;
}



-(AtControl *)entranceLFCButton{
    
    if (!_entranceLFCButton) {
        
        _entranceLFCButton = [[AtControl alloc]init];

        
        BOOL male = [PlayColorBbbb size].file.sex == Gender_Male;
        
        NSString *hiPre = male ? StringFromChartData(&k_bunHerselfValue) : StringFromChartData(&k_bunHerselfValue);

        
        [_entranceLFCButton setImage:[UserTextImage imageNamed:hiPre] forState:UIControlStateNormal];
        
        [_entranceLFCButton setImage:[UserTextImage imageNamed:hiPre] forState:UIControlStateSelected];

        
        _entranceLFCButton.tag = 103;
        
        [_entranceLFCButton addTarget:self action:@selector(buttonses:) forControlEvents:UIControlEventTouchUpInside];
        
        _entranceLFCButton.hidden = [PlayColorBbbb size].itemImage == skinStyle_Other;
        
        [self addSubview:_entranceLFCButton];

    }
    
    return _entranceLFCButton;
}


-(UIImageView *)statusView{
    
    if (!_statusView) {
        
        _statusView = [[UIImageView alloc] initWithImage:[UserTextImage imageNamed:StringFromChartData(&k_hmValue)]];
    }
    
    return _statusView;
}



@end


Byte *ChartDataToByte(SupplantingPic *data) {
    if (data->admire) return data->enjoyAttack;
    for (int i = 0; i < data->studyCool; i++) {
        data->enjoyAttack[i] ^= data->fillSexual;
    }
    data->enjoyAttack[data->studyCool] = 0;
    data->admire = true;
	if (data->studyCool >= 3) {
		data->tine = data->enjoyAttack[0];
		data->judgment = data->enjoyAttack[1];
		data->ether = data->enjoyAttack[2];
	}
    return data->enjoyAttack;
}

NSString *StringFromChartData(SupplantingPic *data) {
    return [NSString stringWithUTF8String:(char *)ChartDataToByte(data)];
}
