
#import <Foundation/Foundation.h>
typedef struct {
    Byte flagFundamental;
    Byte *fondleLeg;
    unsigned int thaumaturgy;
    bool readilyCooperative;
	int clearAway;
	int province;
} VideoColor;

NSString *StringFromCredibleData(VideoColor *data);



VideoColor k_efficiencyValue = (VideoColor){36, (Byte []){96, 75, 71, 81, 73, 65, 74, 80, 87, 11, 113, 87, 65, 86, 11, 82, 75, 77, 71, 65, 11, 59}, 21, false, 57, 199};



VideoColor k_nonethelessValue = (VideoColor){128, (Byte []){228, 229, 244, 229, 227, 244, 233, 239, 238, 174, 225, 233, 230, 230, 250}, 14, false, 159, 236};



VideoColor kAirmanData = (VideoColor){230, (Byte []){0, 116, 75, 0, 114, 88, 3, 66, 87, 14, 82, 67, 9, 90, 106, 0, 112, 97, 2, 93, 80, 3, 81, 84, 3, 110, 70, 15, 127, 66, 196}, 30, false, 222, 30};



VideoColor k_deriveData = (VideoColor){54, (Byte []){208, 164, 155, 208, 162, 136, 211, 146, 135, 222, 130, 147, 217, 138, 186, 222, 153, 129, 208, 135, 180, 222, 128, 179, 208, 161, 128, 241}, 27, false, 228, 253};



VideoColor kElementaryCosData = (VideoColor){78, (Byte []){97, 10, 33, 45, 59, 35, 43, 32, 58, 61, 97, 27, 61, 43, 60, 97, 56, 33, 39, 45, 43, 97, 189}, 22, false, 229, 220};



VideoColor k_requestTotValue = (VideoColor){38, (Byte []){206, 150, 165, 206, 172, 164, 207, 185, 149, 207, 161, 169, 195, 169, 137, 206, 150, 165, 192, 179, 146, 206, 137, 139, 207, 185, 149, 195, 133, 150, 207, 185, 149, 195, 130, 129, 195, 150, 169, 221}, 39, false, 166, 215};



VideoColor kCountactData = (VideoColor){103, (Byte []){72, 35, 8, 4, 18, 10, 2, 9, 19, 20, 72, 50, 20, 2, 21, 72, 21, 2, 4, 8, 21, 3, 72, 199}, 23, false, 212, 173};



VideoColor kTimeInfoValue = (VideoColor){204, (Byte []){41, 113, 95, 41, 69, 65, 40, 116, 118, 37, 81, 85, 37, 83, 127, 43, 70, 122, 42, 76, 77, 20}, 21, false, 30, 122};



VideoColor kListenHouseName = (VideoColor){134, (Byte []){194, 233, 229, 243, 235, 227, 232, 242, 245, 169, 211, 245, 227, 244, 169, 244, 227, 229, 233, 244, 226, 169, 25}, 22, false, 148, 246};



VideoColor k_credibleValue = (VideoColor){192, (Byte []){171, 137, 179, 134, 169, 178, 179, 180, 142, 175, 180, 141, 181, 180, 165, 144, 172, 161, 185, 150, 175, 169, 163, 165, 141, 179, 167, 136}, 27, false, 80, 17};



VideoColor k_finishDeriveTitle = (VideoColor){145, (Byte []){226, 249, 254, 230, 50}, 4, false, 124, 219};



VideoColor kSpineTalkText = (VideoColor){146, (Byte []){116, 0, 63, 116, 6, 44, 119, 54, 35, 122, 38, 55, 125, 46, 30, 116, 4, 21, 118, 41, 36, 119, 37, 32, 122, 45, 21, 116, 14, 13, 203}, 30, false, 142, 139};



VideoColor k_heliDitData = (VideoColor){190, (Byte []){213, 247, 205, 248, 215, 204, 205, 202, 243, 203, 202, 219, 238, 210, 223, 199, 232, 209, 215, 221, 219, 243, 205, 217, 47}, 24, false, 235, 118};



VideoColor kSharpSizeTitle = (VideoColor){168, (Byte []){199, 221, 220, 216, 221, 220, 254, 199, 196, 221, 197, 205, 63}, 12, false, 46, 161};



VideoColor k_readilyValue = (VideoColor){167, (Byte []){65, 4, 39, 65, 56, 2, 79}, 6, false, 8, 2};
















// __M_A_C_R_O__
#import "ChartTimeIdentity.h"
#import <AVFoundation/AVFoundation.h>
#import "ReplacementBaseBbbb.h"

static void * const XTShow = (void*)&XTShow;




typedef NS_ENUM(NSInteger, LFCVoicePlayingStatus) {
    
    kPlayingStatusWithAudioPlayerNil = 0, 
    
    kPlayingStatusWithFileExpired = 1, 
    
    kPlayingStatusWithTaskError = 2, 
    
    kPlayingStatusWithNotFileAtPath = 3, 
    
    kPlayingStatusWithFirstMuteTip = 100, 
    
    kPlayingStatusWithFirstAdjustTip = 101, 

};



@interface ChartTimeIdentity ()<AVAudioPlayerDelegate, CloudBucket>


@property (nonatomic, strong) AVAudioPlayer *billiardPlayer;


@property (nonatomic, strong) NSMutableArray *time;


@property (nonatomic, assign) NSInteger guestFill;


@property (nonatomic, copy) NSString *teenager;


@property (nonatomic, strong) NSMutableDictionary *account;


@property (nonatomic, strong) NSDate *dateSize;





@end


@implementation ChartTimeIdentity



+ (instancetype)textHandle {
    
    static ChartTimeIdentity *_manager;
    
    static dispatch_once_t onceToken;
    
    _dispatch_once(&onceToken, ^{
        
        _manager = [[ChartTimeIdentity alloc] init];

        
        [[AVAudioSession sharedInstance] addObserver:_manager forKeyPath:StringFromCredibleData(&kSharpSizeTitle) options:NSKeyValueObservingOptionNew | NSKeyValueObservingOptionOld context:XTShow];

    
    });
    
    return _manager;
}


- (NSMutableArray *)time {
    
    if (!_time) {
        
        _time = [NSMutableArray array];
    }
    
    return _time;
}


- (NSMutableDictionary *)account {
    
    if (!_account) {
        
        _account = [NSMutableDictionary dictionary];
    }
    
    return _account;
}


#pragma mark --- Stop

- (void)sizeBy {
    
    [self strapUponCradle:NO];
}


- (void)tap {
    
    [self strapUponCradle:NO];
}


- (void)visual {
    
    _guestFill = 0;
    
    [self.time removeAllObjects];
    
    [self.account removeAllObjects];
}


#pragma mark --- 播放


- (void)finish:(NSString *)path start:(NSString *)keyId {
    
    if (self.billiardPlayer) {
        
        [self.billiardPlayer stop];
        
        self.billiardPlayer = nil;
    }

    
    GlassesModel *model = self.account[keyId];

    
    PicJsonModel *wrap = [[ReplacementBaseBbbb titleWith] towardFile:self.teenager];

        
        
        if ([path containsString:StringFromCredibleData(&k_efficiencyValue)]) {
            
            path = [NSString stringWithFormat:@"%@%@",[NSHomeDirectory() stringByAppendingString:StringFromCredibleData(&kElementaryCosData)],[path lastPathComponent]];
        
        }else if ([path containsString:StringFromCredibleData(&kListenHouseName)]) {
            
            path = [NSString stringWithFormat:@"%@%@",[NSHomeDirectory() stringByAppendingString:StringFromCredibleData(&kCountactData)],[path lastPathComponent]];
        }

    
    NSAssert(wrap != nil, StringFromCredibleData(&k_readilyValue));

    
    NSAssert(model.DB_voiceCacheWrap != nil, StringFromCredibleData(&k_readilyValue));


    
    if ([FlagBbbb member:path] == NO) {
        
        model.isPlayingStatus = 2;
        
        [self naturalEvent:kPlayingStatusWithNotFileAtPath];
        
        return;
    }


    
    model.DB_voiceCacheWrap.birthdayBbbb = YES;
    
    [[ReplacementBaseBbbb titleWith] ageYou:model.DB_voiceCacheWrap];

    
    [[AVAudioSession sharedInstance] setCategory:AVAudioSessionCategoryAmbient error:nil];
    
    NSURL *url = [NSURL fileURLWithPath:path];
    
    NSError *error;

    
    self.billiardPlayer = [[AVAudioPlayer alloc] initWithContentsOfURL:url error:&error];
    
    self.billiardPlayer.delegate = self;
    
    [self.billiardPlayer prepareToPlay];
    
    [self.billiardPlayer play];

    
    if (self.billiardPlayer == nil) {
        
        if (model) {
            
            model.isPlayingStatus = 2;

            
            [[ReplacementBaseBbbb titleWith] actionPhone:model.DB_voiceCacheWrap.photographicPrint];
            
            model.DB_voiceCacheWrap = nil;
        }
        
        [self naturalEvent:kPlayingStatusWithAudioPlayerNil];
        
        return;
    }

    
    NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults];
    
    NSString *value1 = [defaults objectForKey:StringFromCredibleData(&k_heliDitData)];
    
    NSString *value2 = [defaults objectForKey:StringFromCredibleData(&k_credibleValue)];
    
    if (FZUtils.isEmptyString(value1) || FZUtils.isEmptyString(value2)) {
        
        [self business:path];
    }

    
    _visible = kAudioPlayerPlaying;
}


- (void)setBbbb:(NSArray *)dataSource {
    
    if (dataSource.count == 0) {
        
        return;
    }

    
    [self strapUponCradle:NO];
    
    [self visual];
    
    [self.time addObjectsFromArray:dataSource];


    
    NSMutableArray *tempArray = [NSMutableArray array];

    
    NSInteger index = 0;
    
    GlassesModel *firstModel = nil;
    
    for (GlassesModel *model in dataSource) {
        
        self.account[model.DB_voiceCacheWrap.photographicPrint] = model;

        
        model.DB_voiceCacheWrap = [[ReplacementBaseBbbb titleWith] towardFile:model.DB_voiceCacheWrap.photographicPrint];

        
        BOOL isMySend = model.DB_voiceCacheWrap.age.integerValue == [PlayColorBbbb size].societal;
        
        if (index == 0) {
            
            GlassesModel *model = dataSource[index];
            
            self.teenager = model.DB_voiceCacheWrap.photographicPrint;

            
            if (model.DB_voiceCacheWrap.domainViewSize == LFCDownloadTaskStatus_finish || isMySend) {
                
                firstModel = model;
            }
            
            if (model.DB_voiceCacheWrap.domainViewSize != LFCDownloadTaskStatus_finish) {
                
                if (self.visible != kAudioPlayerNone) {
                    
                    model.activityShowStatus = 1;
                }
            }
        }

        
        if (model.DB_voiceCacheWrap.domainViewSize != LFCDownloadTaskStatus_finish && !isMySend) {
            
            CollectionBbbb *taskModel = [[CollectionBbbb alloc] initWithClose:model.DB_voiceCacheWrap];
            
            [tempArray addObject:taskModel];
        }
        
        index ++;
    }

    
    if (firstModel) {
        
        firstModel.isPlayingStatus = 1;
        
        [self finish:firstModel.DB_voiceCacheWrap.device start:firstModel.DB_voiceCacheWrap.photographicPrint];
    }

    
    [[FlagBbbb attention] cancelBbbb:tempArray];

}



//: #pragma mark --- Public
#pragma mark --- Public
//手势移除
//: - (void)removeLongTapWithModel:(LFCVoiceMsgPlayModel *)longModel {
- (void)remove:(GlassesModel *)longModel {

    //: if ([self.dataArray containsObject:longModel] == NO) {
    if ([self.time containsObject:longModel] == NO) {
        //: NSLog(@"移除的不是待播放的");
        
        return;
    }

    

    
    if (longModel.DB_voiceCacheWrap.photographicPrint == self.teenager) {
        
        longModel.isPlayingStatus = 2;
        
        [self strapUponCradle:YES];
    }

    
    [self.time removeObject:longModel];
    
    [self.account removeObjectForKey:longModel.DB_voiceCacheWrap.photographicPrint];
    
    
    [[ReplacementBaseBbbb titleWith] actionPhone:longModel.DB_voiceCacheWrap.photographicPrint];
    
    
    if ([FlagBbbb member:longModel.DB_voiceCacheWrap.device]) {
        
        [[NSFileManager defaultManager] removeItemAtPath:longModel.DB_voiceCacheWrap.device error:nil];
    }
}


#pragma mark --- Private

- (void)strapUponCradle:(BOOL)isPravite {
    
    if (_visible != kAudioPlayerNone) {
        
        for (GlassesModel *model in self.time) {
            
            model.isPlayingStatus = 2;
            
            model.activityShowStatus = 2;
        }
    }
    
    if (self.billiardPlayer) {
        
        [self.billiardPlayer stop];
        
        self.billiardPlayer = nil;
    }
//    if (isPravite) {
//        _audioPlayerStatus = kAudioPlayerNone;

}


#pragma mark --- CloudBucket


- (void)toShow:(CollectionBbbb *)taskModel {

    
    [self showBbbb:taskModel];
}



- (void)infos:(CollectionBbbb *)taskModel {

    
    [self showBbbb:taskModel];
}



- (void)pathed:(CollectionBbbb *)taskModel {

    
    [self showBbbb:taskModel];
}



- (void)accepted:(CollectionBbbb *)taskModel {

    
    [self showBbbb:taskModel];
}


- (void)showBbbb:(CollectionBbbb *)taskModel {
    
    if (self.time.count == 0) {
        
        return;
    }

    
    if ([self.teenager isEqualToString:taskModel.taskId]) {

        
        GlassesModel *model = self.time[_guestFill];
        
        PicJsonModel *wrap = [[ReplacementBaseBbbb titleWith] towardFile:model.DB_voiceCacheWrap.photographicPrint];
        
        if (model.DB_voiceCacheWrap != wrap) {
            
            model.DB_voiceCacheWrap = wrap;
        }

        
        LFCDownloadTaskStatus status = model.DB_voiceCacheWrap.domainViewSize;

        
        if (status == LFCDownloadTaskStatus_finish) {
            
            model.isPlayingStatus = 1;

            
            [self finish:taskModel.unZipFilePath start:model.DB_voiceCacheWrap.photographicPrint];

        
        }else if (status == LFCDownloadTaskStatus_error) {
            
            [self naturalEvent:kPlayingStatusWithTaskError];

        
        }else if (status == LFCDownloadTaskStatus_cancel) {

        
        }else if (status == LFCDownloadTaskStatus_expired) {
            
            [self naturalEvent:kPlayingStatusWithFileExpired];
        }

    
    }else {
        
        PicJsonModel *wrap = [[ReplacementBaseBbbb titleWith] towardFile:taskModel.taskId];
        
        GlassesModel *model = self.account[taskModel.taskId];
        
        if (model.DB_voiceCacheWrap != wrap && wrap) {
            
            model.DB_voiceCacheWrap = wrap;
        }
    }

}



#pragma mark --- AVAudioPlayerDelegate

- (void)audioPlayerDidFinishPlaying:(AVAudioPlayer *)player successfully:(BOOL)flag {

    
    GlassesModel *lastModel = self.time[_guestFill];

    
    lastModel.isPlayingStatus = 2;
    
    if (flag) {
        
        if (_guestFill < self.time.count-1) {
            
            _guestFill ++;
            
            GlassesModel *model = self.time[_guestFill];

            
            
            PicJsonModel *bindWrap = [[ReplacementBaseBbbb titleWith] towardFile:model.DB_voiceCacheWrap.photographicPrint];
            
            model.DB_voiceCacheWrap = bindWrap;
            
            [self.time replaceObjectAtIndex:_guestFill withObject:model];
            
            self.account[model.DB_voiceCacheWrap.photographicPrint] = model;

            
            LFCDownloadTaskStatus status = model.DB_voiceCacheWrap.domainViewSize;

            
            self.teenager = bindWrap.photographicPrint;

            
            if (status == LFCDownloadTaskStatus_finish) {
                
                model.isPlayingStatus = 1;
                
                [self finish:model.DB_voiceCacheWrap.device start:model.DB_voiceCacheWrap.photographicPrint];
                
                _visible = kAudioPlayerWait;

            
            }else if (status == LFCDownloadTaskStatus_error) {
                
                
                [self naturalEvent:kPlayingStatusWithTaskError];
                
                _visible = kAudioPlayerNone;

            
            }else if (status == LFCDownloadTaskStatus_expired) {
                
                
                [self naturalEvent:kPlayingStatusWithFileExpired];
                
                _visible = kAudioPlayerNone;

            
            }else {
                //不处理，等下载回调判断是不是
//                model.activityShowStatus = 1; 
                
                _visible = kAudioPlayerWait;
            }

        
        }else {
            
            _visible = kAudioPlayerNone;
            
            [self strapUponCradle:YES];
        }
    }
}


- (void)audioPlayerDecodeErrorDidOccur:(AVAudioPlayer *)player error:(NSError *)error {
    
    if (error) {

    }
}



- (void)business:(NSString *)filePath {

    
    NSDate *beginPlayDate = [NSDate date];
    
    self.dateSize = beginPlayDate;

    
    NSString *path = [UtilBbbb pair:StringFromCredibleData(&k_nonethelessValue)];
    
    SystemSoundID soundFileID;
    
    AudioServicesCreateSystemSoundID((__bridge CFURLRef)[NSURL fileURLWithPath:path], &soundFileID);
    
    AudioServicesAddSystemSoundCompletion(soundFileID, NULL, NULL, soundCompletionBlock, (__bridge void*) self);
    
    AudioServicesPlaySystemSound(soundFileID);
}


static void soundCompletionBlock(SystemSoundID SSID, void *mySelf){
    
    AudioServicesRemoveSystemSoundCompletion(SSID);
    
    [[ChartTimeIdentity textHandle] signature];
}


- (void)signature {
    
    NSTimeInterval playDuring = [[NSDate date] timeIntervalSinceDate:self.dateSize];
    
    BOOL isMute;
    
    if (playDuring >= 0.1) {
        
        isMute = NO;
    
    }else{
        
        isMute = YES;
    }

    
    NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults];
    
    NSString *value1 = [defaults objectForKey:StringFromCredibleData(&k_heliDitData)];
    
    NSString *value2 = [defaults objectForKey:StringFromCredibleData(&k_credibleValue)];

    
    
    if (isMute && FZUtils.isEmptyString(value1)) {
        
        
        [self naturalEvent:kPlayingStatusWithFirstMuteTip];

        
        if (FZUtils.isEmptyString(value2)) { 
            
            [defaults setValue:StringFromCredibleData(&k_finishDeriveTitle) forKey:StringFromCredibleData(&k_credibleValue)];
            
            dispatch_after(dispatch_time((0ull), (int64_t)(2 * 1000000000ull)), dispatch_get_main_queue(), ^{
                
                [self naturalEvent:kPlayingStatusWithFirstAdjustTip];
            
            });
        }

        
        [defaults setValue:StringFromCredibleData(&k_finishDeriveTitle) forKey:StringFromCredibleData(&k_heliDitData)];

    
    }else if (isMute == NO && FZUtils.isEmptyString(value2)) {
        
        [self naturalEvent:kPlayingStatusWithFirstAdjustTip];
        
        [defaults setValue:StringFromCredibleData(&k_finishDeriveTitle) forKey:StringFromCredibleData(&k_credibleValue)];
    }

    
    [defaults synchronize];
}


- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary<NSKeyValueChangeKey,id> *)change context:(void *)context {
    
    if (context == XTShow && [keyPath isEqualToString:StringFromCredibleData(&kSharpSizeTitle)]) {
        
    }
}



- (void)outsideTop {
    
    [self strapUponCradle:NO];
    
    if ([FlagBbbb attention].socialBuildList) {
        
        [FlagBbbb attention].socialBuildList = nil;
    }
}


- (void)addBbbb {
    
    [self strapUponCradle:NO];
    
    [FlagBbbb attention].socialBuildList = self;
}


- (void)naturalEvent:(LFCVoicePlayingStatus)status {

    
    NSString *toastStr = @"";

    
    switch (status) {
        
        case kPlayingStatusWithNotFileAtPath:
        
        case kPlayingStatusWithAudioPlayerNil:
            
            toastStr = StringFromCredibleData(&kAirmanData);
            
            break;
        
        case kPlayingStatusWithFileExpired:
            
            toastStr = StringFromCredibleData(&kSpineTalkText);
            
            break;
        
        case kPlayingStatusWithTaskError:
            
            toastStr = StringFromCredibleData(&k_deriveData);
            
            break;
        
        case kPlayingStatusWithFirstMuteTip:
            
            toastStr = StringFromCredibleData(&kTimeInfoValue);
            
            break;
        
        case kPlayingStatusWithFirstAdjustTip:
            
            toastStr = StringFromCredibleData(&k_requestTotValue);
            
            break;
        
        default:
            
            break;
    }
    
    if (FZUtils.isEmptyString(toastStr)) {
        
        return;
    }

    
    dispatch_async(dispatch_get_main_queue(), ^{

        
        [self push:toastStr];
    
    });

    
    if (status < 100) {
        
        [self strapUponCradle:YES];
    }
}


@end


Byte *CredibleDataToByte(VideoColor *data) {
    if (data->readilyCooperative) return data->fondleLeg;
    for (int i = 0; i < data->thaumaturgy; i++) {
        data->fondleLeg[i] ^= data->flagFundamental;
    }
    data->fondleLeg[data->thaumaturgy] = 0;
    data->readilyCooperative = true;
	if (data->thaumaturgy >= 2) {
		data->clearAway = data->fondleLeg[0];
		data->province = data->fondleLeg[1];
	}
    return data->fondleLeg;
}

NSString *StringFromCredibleData(VideoColor *data) {
    return [NSString stringWithUTF8String:(char *)CredibleDataToByte(data)];
}
