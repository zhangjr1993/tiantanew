
#import <Foundation/Foundation.h>

NSString *StringFromFundamentalTableData(Byte *data);        



Byte kEnableTitle[] = {83, 48, 20, 8, 2, 177, 67, 89, 209, 145, 169, 209, 145, 169, 211, 113, 147, 213, 141, 170, 212, 115, 150, 209, 163, 157, 219, 168, 120, 208, 164, 121, 212, 141, 120, 209, 156, 157, 212, 154, 149, 210, 116, 125, 210, 137, 145, 211, 113, 147, 213, 141, 170, 208, 169, 140, 134};



Byte k_stressName[] = {55, 60, 7, 11, 214, 196, 203, 241, 34, 151, 124, 225, 125, 138, 222, 166, 137, 224, 149, 152, 224, 158, 151, 222, 158, 128, 232, 181, 133, 222, 184, 146, 224, 147, 125, 225, 159, 122, 223, 166, 180, 232, 181, 133, 221, 178, 152, 225, 159, 122, 224, 142, 146, 221, 177, 163, 222, 169, 136, 224, 181, 150, 222, 125, 184, 223, 124, 172, 221, 182, 153, 23};



Byte k_shelfData[] = {37, 7, 10, 9, 86, 16, 5, 88, 152, 25, 60, 60, 58, 56, 55, 57, 186};



Byte k_stateStrokeVariationName[] = {69, 42, 31, 5, 151, 198, 135, 99, 199, 127, 125, 199, 120, 151, 202, 120, 149, 201, 100, 158, 198, 97, 115, 202, 97, 97, 208, 157, 109, 197, 158, 129, 199, 125, 97, 199, 100, 148, 198, 98, 123, 197, 156, 97, 197, 154, 105, 22};



Byte k_amazingName[] = {43, 57, 10, 14, 127, 215, 17, 73, 252, 68, 162, 135, 245, 255, 219, 126, 161, 218, 176, 176, 219, 124, 131, 219, 155, 179, 223, 121, 179, 220, 142, 165, 219, 126, 161, 218, 176, 176, 221, 144, 122, 229, 178, 130, 220, 126, 135, 218, 174, 131, 218, 174, 118, 220, 150, 173, 229, 178, 130, 220, 126, 135, 220, 142, 165, 218, 179, 150, 221, 144, 122, 222};



Byte k_wildlifeContent[] = {75, 54, 91, 13, 175, 2, 142, 204, 26, 191, 212, 149, 234, 139, 45, 54, 140, 63, 41, 140, 81, 54, 138, 52, 84, 137, 96, 74, 140, 96, 62, 139, 84, 52, 137, 93, 79, 137, 95, 95, 148, 97, 49, 137, 98, 43, 139, 45, 54, 140, 63, 41, 140, 45, 86, 138, 52, 79, 141, 40, 98, 140, 96, 62, 137, 98, 69, 106};



Byte k_softlyText[] = {53, 39, 50, 7, 38, 167, 78, 179, 101, 118, 189, 138, 90, 178, 139, 110, 180, 106, 78, 179, 100, 106, 180, 122, 112, 181, 104, 82, 178, 134, 78, 183, 81, 118, 181, 98, 131, 179, 139, 127, 180, 102, 125, 189, 138, 109, 159};



Byte k_attitudeData[] = {58, 6, 65, 12, 6, 28, 16, 103, 173, 229, 92, 234, 164, 78, 80, 168, 63, 64, 211};



Byte k_attributeSocialContent[] = {22, 45, 46, 10, 135, 185, 156, 163, 42, 242, 183, 130, 97, 183, 101, 119, 183, 101, 119, 193, 142, 94, 182, 143, 114, 183, 104, 110, 184, 126, 116, 182, 141, 82, 182, 139, 90, 184, 114, 137, 183, 127, 98, 185, 108, 86, 183, 119, 133, 185, 102, 113, 183, 99, 116, 204};



Byte kLoveValue[] = {40, 51, 20, 9, 35, 53, 95, 182, 180, 209, 123, 155, 208, 164, 121, 209, 123, 155, 208, 167, 145, 209, 109, 134, 208, 169, 140, 211, 134, 112, 209, 156, 123, 209, 113, 152, 208, 164, 167, 219, 168, 120, 209, 123, 150, 209, 124, 111, 211, 159, 130, 208, 164, 121, 209, 124, 111, 212, 119, 146, 165};



Byte kCountactPeakViewText[] = {16, 72, 59, 10, 90, 43, 96, 155, 214, 172, 169, 127, 127, 171, 69, 128, 171, 93, 116, 169, 129, 95, 170, 84, 93, 172, 95, 73, 180, 129, 81, 169, 128, 83, 169, 125, 69, 170, 129, 69, 170, 108, 80, 172, 95, 73, 170, 91, 97, 171, 113, 103, 169, 130, 101, 180, 129, 81, 170, 77, 117, 170, 85, 83, 171, 98, 106, 172, 95, 73, 171, 96, 121, 170, 91, 97, 171, 113, 103, 169, 130, 101, 146};



Byte kWithdrawData[] = {70, 6, 46, 6, 99, 9, 183, 97, 104, 184, 136, 90, 42};



Byte kUnemploymentTitle[] = {77, 12, 83, 14, 115, 230, 97, 233, 72, 195, 235, 46, 217, 108, 146, 108, 88, 147, 58, 100, 148, 65, 85, 149, 92, 90, 196};



Byte kSearchRequestValue[] = {13, 30, 15, 9, 12, 129, 254, 109, 200, 216, 140, 165, 215, 127, 150, 216, 115, 170, 224, 173, 125, 215, 121, 130, 215, 131, 154, 213, 174, 145, 217, 146, 125, 213, 169, 126, 217, 146, 125, 43};













// __M_A_C_R_O__
#import "RankDisplayView.h"

NSString* const LFCSocialChatFastReplyCellReuseID = @"LFCSocialChatFastReplyCellReuseID";


@interface StatuteTitleView : UITableViewCell


@property(nonatomic,strong,readwrite) UIView* clickWith;

@property(nonatomic,strong,readwrite) UILabel* label;


@property(nonatomic,strong,readwrite) NSString* balanceShow;

@property(nonatomic,assign,readwrite) BOOL tool ;


@property(nonatomic,assign,readwrite) NSInteger withDelayVideo ;


@property (nonatomic, copy) void (^level)(NSInteger index);


@end


@implementation StatuteTitleView


+ (instancetype)be:(UITableView*)tableView{
    
    StatuteTitleView* cell = [tableView dequeueReusableCellWithIdentifier:LFCSocialChatFastReplyCellReuseID];
    
    if (!cell) {
        
        cell = [[self alloc] initWithStyle:(UITableViewCellStyleDefault) reuseIdentifier:LFCSocialChatFastReplyCellReuseID];
        
        cell.selectionStyle = UITableViewCellSelectionStyleNone;
        
        cell.backgroundColor = [UIColor whiteColor];
    }
    
    return cell;
}


- (instancetype)initWithStyle:(UITableViewCellStyle)style reuseIdentifier:(NSString *)reuseIdentifier{
    
    if (self = [super initWithStyle:style reuseIdentifier:reuseIdentifier]) {
        
        [self with];
    }
    
    return self;
}


- (void)setBalanceShow:(NSString *)contentStr{
    
    _balanceShow = contentStr;
}


- (void)setTool:(BOOL)currentSelected{
    
    _tool = currentSelected;
    
    self.clickWith.backgroundColor = currentSelected ? [UIColor colorWithHexString:StringFromFundamentalTableData(k_shelfData)] : [UIColor colorWithRed:(238)/255.0f green:(238)/255.0f blue:(238)/255.0f alpha:1.0f];
    
    NSMutableParagraphStyle* style = [[NSMutableParagraphStyle alloc] init];
    
    style.alignment = NSTextAlignmentLeft;
    
    style.lineBreakMode = NSLineBreakByWordWrapping;
    
    style.lineSpacing = 3;
    
    NSAttributedString* str = [[NSAttributedString alloc] initWithString:self.balanceShow attributes:@{NSFontAttributeName:self.label.font,NSParagraphStyleAttributeName:style.copy,NSForegroundColorAttributeName:currentSelected ? [ShowColor current] : [ShowColor table]}];
    
    self.label.attributedText = str;
}


- (CGFloat)requestContent{
    
    NSMutableParagraphStyle* style = [[NSMutableParagraphStyle alloc] init];
    
    style.alignment = NSTextAlignmentLeft;
    
    style.lineBreakMode = NSLineBreakByWordWrapping;
    
    style.lineSpacing = 3;
    
    NSAttributedString* str = [[NSAttributedString alloc] initWithString:self.balanceShow attributes:@{NSFontAttributeName:self.label.font,NSParagraphStyleAttributeName:style.copy}];
    
    self.label.attributedText = str;
    
    CGFloat height = [self.label sizeThatFits:CGSizeMake(screenWidth() - 2 * 21, 0x1.fffffep+127f)].height;
    
    return height + 20;
}


- (void)with{
    
    [self.clickWith mas_makeConstraints:^(MASConstraintMaker *make) {
        
        make.left.offset(15);
        
        (void)make.bottom;
        
        make.top.offset(10);
        
        make.right.equalTo(self.label.mas_right).offset(6);
    
    }];

    
    [self.label mas_makeConstraints:^(MASConstraintMaker *make) {
        
        make.left.offset(21);
        
        make.right.lessThanOrEqualTo(self.contentView).offset(-15);
        
        make.bottom.offset(-5);
    
    }];

    
    UITapGestureRecognizer* tap = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(viewI)];
    
    [self.clickWith addGestureRecognizer:tap];
}


- (void)viewI{
    
    if (self.level) {
        
        self.level(self.withDelayVideo);
    }
}


- (UIView *)clickWith{
    
    if (!_clickWith) {
        
        _clickWith = [[UIView alloc] init];
        
        _clickWith.backgroundColor = [UIColor colorWithRed:(238)/255.0f green:(238)/255.0f blue:(238)/255.0f alpha:1.0f];
        
        _clickWith.layer.cornerRadius = 5.0f;
        
        _clickWith.layer.masksToBounds = YES;
        
        [self.contentView addSubview:_clickWith];
    }
    
    return _clickWith;
}


- (UILabel *)label{
    
    if (!_label) {
        
        _label = [[UILabel alloc] init];
        
        _label.font = [UIFont underbelly:(PFSCTypeRegular) substance:15.0f];
        
        _label.numberOfLines = 0;
        
        _label.preferredMaxLayoutWidth = screenWidth() - 2 * 21;
        
        [self.contentView addSubview:_label];
    }
    
    return _label;
}


@end


@interface RankDisplayView ()<UITableViewDelegate,UITableViewDataSource>


@property(nonatomic,strong,readwrite) UIView* bubbleView;

@property(nonatomic,strong,readwrite) AtControl* familyLevel;

@property(nonatomic,strong,readwrite) AtControl* magnitudeList;

@property(nonatomic,strong,readwrite) UILabel* hiddenBlack;

@property(nonatomic,strong,readwrite) UITableView* send;


@property(nonatomic,strong,readwrite) NSArray<NSString*>* buttonReply;

@property(nonatomic,strong,readwrite) NSMutableDictionary* info;


@property(nonatomic,assign,readwrite) NSInteger user ;

@end


@implementation RankDisplayView


- (instancetype)initWithFrame:(CGRect)frame{
    
    if (self = [super initWithFrame:frame]) {
        
        [self bbbbTap];
    }
    
    return self;
}


- (void)bbbbTap{

    
    [self.bubbleView mas_makeConstraints:^(MASConstraintMaker *make) {
        
        (void)make.top.left.right;
        
        make.height.mas_equalTo(50);
    
    }];

    
    [self.hiddenBlack mas_makeConstraints:^(MASConstraintMaker *make) {
        
        (void)make.center;
    
    }];

    
    [self.familyLevel mas_makeConstraints:^(MASConstraintMaker *make) {
        
        make.left.offset(15);
        
        (void)make.top.bottom;
    
    }];

    
    [self.magnitudeList mas_makeConstraints:^(MASConstraintMaker *make) {
        
        make.right.offset(-15);
        
        (void)make.top.bottom;
    
    }];

    
    [self.send mas_makeConstraints:^(MASConstraintMaker *make) {
        
        make.top.equalTo(self.bubbleView.mas_bottom);
        
        (void)make.left.right;
        
        make.height.mas_equalTo(safeAreaBottomHeight() ? 238 : 258);
    
    }];
    
    NSArray* replyList = [PlayColorBbbb size].familyDescriptionAddtion.replyList;
    
    if (replyList && [replyList isKindOfClass:[NSArray class]] && replyList.count) {
        
        self.buttonReply = [replyList mutableCopy];
    
    }else{
        
        [self buttonReply];
    }
    
    self.magnitudeList.enabled = NO;
    
    self.backgroundColor = [UIColor whiteColor];
    
    self.user = -1;
}

#pragma mark - actions

- (void)clewPartner{
    
    if (self.need) {
        
        self.need();
    }
}


- (void)mildFriend{
    
    if (self.user >= 0 && self.user < self.buttonReply.count) {
        
        NSString* selectedReply = self.buttonReply[self.user];
        
        if (self.dot) {
            
            self.dot(selectedReply);
        }
    }
}


- (void)communication{
    
    if (self.user >= 0) {
        
        self.user = -1;
        
        [self.send reloadData];
        
        [self.send setContentOffset:CGPointMake(0, 0)];
        
        self.magnitudeList.enabled = NO;
    }
}


#pragma mark - UITableViewDelegate,UITableViewDataSource

- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section{
    
    return self.buttonReply.count;
}


- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath{
    
    StatuteTitleView* cell = [StatuteTitleView be:tableView];
    
    cell.balanceShow = self.buttonReply[indexPath.row];
    
    cell.tool = self.user == indexPath.row;
    
    cell.withDelayVideo = indexPath.row;
    
    @autoreleasepool {} __weak __typeof__(self) self_weak_ = (self);;
    
    [cell setLevel:^(NSInteger index) {
        
        @autoreleasepool {}
         __strong __typeof__(self) self = self_weak_;
                        ;
        
        self.user = index;
        
        [self.send reloadData];
        
        self.magnitudeList.enabled = self.user >= 0;
    
    }];
    
    return cell;
}


- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath{
    
    NSString* key = self.buttonReply[indexPath.row];
    
    CGFloat height = [self.info[key] doubleValue];
    
    if (!height) {
        
        StatuteTitleView* cell = [StatuteTitleView be:tableView];
        
        cell.balanceShow = self.buttonReply[indexPath.row];
        
        height = [cell requestContent];
        
        [self.info setObject:@(height) forKey:key];
    }
//    NSLog(@"行数 %zd,高度 %lf",indexPath.row,height);
    
    return height;
}


#pragma mark - views

- (UIView *)bubbleView{
    
    if (!_bubbleView) {
        
        _bubbleView = [[UIView alloc] init];
        
        _bubbleView.backgroundColor = [UIColor whiteColor];
        
        [self addSubview:_bubbleView];
    }
    
    return _bubbleView;
}


- (AtControl *)familyLevel{
    
    if (!_familyLevel) {
        
        _familyLevel = [AtControl new];
        
        [_familyLevel setTitle:StringFromFundamentalTableData(kWithdrawData) forState:(UIControlStateNormal)];
        
        _familyLevel.titleLabel.font = [UIFont underbelly:(PFSCTypeMedium) substance:16.0f];
        
        [_familyLevel setTitleColor:[ShowColor input] forState:(UIControlStateNormal)];
        
        [_familyLevel addTarget:self action:@selector(clewPartner) forControlEvents:(UIControlEventTouchUpInside)];
        
        [self.bubbleView addSubview:_familyLevel];
    }
    
    return _familyLevel;
}


- (UILabel *)hiddenBlack{
    
    if (!_hiddenBlack) {
        
        _hiddenBlack = [[UILabel alloc] init];
        
        _hiddenBlack.font = [UIFont underbelly:(PFSCTypeRegular) substance:16.0f];
        
        _hiddenBlack.textColor = [ShowColor current];
        
        _hiddenBlack.text = StringFromFundamentalTableData(kUnemploymentTitle);
        
        [self.bubbleView addSubview:_hiddenBlack];
    }
    
    return _hiddenBlack;
}


- (AtControl *)magnitudeList{
    
    if (!_magnitudeList) {
        
        _magnitudeList = [AtControl new];
        
        [_magnitudeList setTitle:(StringFromFundamentalTableData(k_attitudeData)) forState:(UIControlStateNormal)];
        
        _magnitudeList.titleLabel.font = [UIFont underbelly:(PFSCTypeMedium) substance:16.0f];
        
        [_magnitudeList setTitleColor:[ShowColor input] forState:(UIControlStateDisabled)];
        
        [_magnitudeList setTitleColor:[ShowColor send] forState:(UIControlStateNormal)];
        
        [_magnitudeList addTarget:self action:@selector(mildFriend) forControlEvents:(UIControlEventTouchUpInside)];
        
        [self.bubbleView addSubview:_magnitudeList];
    }
    
    return _magnitudeList;
}


- (UITableView *)send{
    
    if (!_send) {
        
        _send = [[UITableView alloc] initWithFrame:CGRectZero style:(UITableViewStylePlain)];
        
        _send.delegate = self;
        
        _send.dataSource = self;
        
        _send.bounces = NO;
        
        _send.showsVerticalScrollIndicator = NO;
        
        _send.backgroundColor = [UIColor whiteColor];
        
        _send.contentInset = UIEdgeInsetsMake(0, 0, 10, 0);
        
        _send.separatorStyle = UITableViewCellSeparatorStyleNone;
        
        if (@available(iOS 11.0, *)) {
            
            _send.contentInsetAdjustmentBehavior = UIScrollViewContentInsetAdjustmentNever;
        }
        
        [self addSubview:_send];
    }
    
    return _send;
}


- (NSArray<NSString *> *)buttonReply{
    
    if (!_buttonReply) {
        
        NSArray* girlArr = @[StringFromFundamentalTableData(kSearchRequestValue),StringFromFundamentalTableData(k_attributeSocialContent),StringFromFundamentalTableData(k_wildlifeContent),StringFromFundamentalTableData(k_stateStrokeVariationName),StringFromFundamentalTableData(kLoveValue)];
        
        NSArray* boyArr = @[StringFromFundamentalTableData(kCountactPeakViewText),StringFromFundamentalTableData(kEnableTitle),StringFromFundamentalTableData(k_stressName),StringFromFundamentalTableData(k_softlyText),StringFromFundamentalTableData(k_amazingName)];
        
        _buttonReply = [PlayColorBbbb size].file.sex == Gender_Male ? boyArr : girlArr;
    }
    
    return _buttonReply;
}


- (NSMutableDictionary*)info{
    
    if (!_info) {
        
        _info = [NSMutableDictionary dictionary];
    }
    
    return _info;
}



@end


Byte * FundamentalTableDataToCache(Byte *data) {
    int diversCycleCurrent = data[0];
    int talkGray = data[1];
    Byte unfortunatelyHotel = data[2];
    int hut = data[3];
    if (!diversCycleCurrent) return data + hut;
    for (int i = hut; i < hut + talkGray; i++) {
        int value = data[i] + unfortunatelyHotel;
        if (value > 255) {
            value -= 256;
        }
        data[i] = value;
    }
    data[0] = 0;
    data[hut + talkGray] = 0;
    return data + hut;
}

NSString *StringFromFundamentalTableData(Byte *data) {
    return [NSString stringWithUTF8String:(char *)FundamentalTableDataToCache(data)];
}
